<!DOCTYPE html>
<html lang="th">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>CDDWomenfund Dashboard</title>Â 
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
Â  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
Â  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
Â  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

Â  <style>
Â  Â  /* ğŸŒ¸ à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸à¸²à¸ªà¹€à¸—à¸¥à¸Šà¸¡à¸à¸¹-à¸¡à¹ˆà¸§à¸‡ */
Â  Â  body {
Â  Â  Â  font-family: 'Sarabun', sans-serif;
Â  Â  Â  margin: 0;
Â  Â  Â  background: linear-gradient(to bottom right, #ffe6f0, #f3e5f5, #e1bee7);
Â  Â  Â  background-attachment: fixed;
Â  Â  Â  color: #000;
Â  Â  }

Â  Â  .dashboard-container {Â 
Â  Â  Â  padding: 40px;Â 
Â  Â  Â  background-color: rgba(255, 255, 255, 0.9);
Â  Â  Â  min-height: 100vh;
Â  Â  }
Â  Â  .scale-control { font-size: 1rem; }

Â  Â  .header {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: flex-start;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  .header-text h1 { margin: 0; font-size: 2.5rem; }
Â  Â  .header-text h2 { margin: 0; font-size: 1.5rem; }
Â  Â  .logo-container img { height: 60px; margin-left: 10px; }

Â  Â  /* Cards */
Â  Â  .cards {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }
Â  Â  .card {
Â  Â  Â  flex: 1;
Â  Â  Â  min-width: 250px;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  color: white;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  .card .value {
Â  Â  Â  font-size: 1.75rem;
Â  Â  Â  color: black;
Â  Â  Â  margin-top: 10px;
Â  Â  Â  font-weight: normal;
Â  Â  Â  white-space: nowrap;
Â  Â  }

Â  Â  .card.pink { background-color: #e91e63; flex: 0 0 auto; width: auto; }
Â  Â  .card.light-pink { background-color: #f8bbd0; }
Â  Â  .card.orange { background-color: #ff9800; }
Â  Â  .card.pastel-pink { background-color: #fce4ec; }
Â  Â  .card.deep-pastel-pink { background-color: #f06292; }

Â  Â  .main-visuals {
Â  Â  Â  display: flex;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  gap: 20px;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  align-items: flex-start;
Â  Â  }
Â  Â  .left, .center, .right { flex: 1; min-width: 300px; }
Â  Â  .center { text-align: center; }

Â  Â  canvas { max-width: 100%; }
Â  Â  #donutChart { height: 500px !important; }

Â  Â  .section-title {
Â  Â  Â  text-align: center;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin: 10px 0;
Â  Â  Â  font-size: 1.2rem;
Â  Â  }

Â  Â  .center img {
Â  Â  Â  width: 250px;
Â  Â  Â  display: block;
Â  Â  Â  margin: 0 auto 10px;
Â  Â  }

Â  Â  /* Table */
Â  Â  .province-table-wrapper {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  margin-left: 3cm;
Â  Â  Â  text-align: left !important;
Â  Â  }

Â  Â  .summary-table {
Â  Â  Â  width: 100% !important;
Â  Â  Â  border-collapse: separate;
Â  Â  Â  border-spacing: 0;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  color: black;
Â  Â  Â  table-layout: fixed;
Â  Â  }

Â  Â  /* âœ… à¹à¸à¹‰à¹„à¸‚: à¸›à¸£à¸±à¸šà¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡à¹ƒà¸«à¹‰à¸ªà¸¹à¸‡ 2 à¹à¸–à¸§ à¹à¸¥à¸°à¸­à¸¢à¸¹à¹ˆà¸•à¸£à¸‡à¸à¸¥à¸²à¸‡ */
Â  Â  .summary-table th {
Â  Â  Â  background-color: #f06292;
Â  Â  Â  color: black;
Â  Â  Â  padding: 8px;
Â  Â  Â  border: 1px solid #f8bbd0;
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-align: center; /* à¸ˆà¸±à¸”à¸à¸¥à¸²à¸‡à¹à¸™à¸§à¸™à¸­à¸™ */
Â  Â  Â  vertical-align: middle; /* à¸ˆà¸±à¸”à¸à¸¥à¸²à¸‡à¹à¸™à¸§à¸•à¸±à¹‰à¸‡ */
Â  Â  Â  white-space: normal; /* à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸•à¸±à¸”à¸„à¸³ */
Â  Â  Â  word-wrap: break-word;
Â  Â  Â  line-height: 1.3;
Â  Â  Â  height: 70px; /* à¸à¸³à¸«à¸™à¸”à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸£à¸­à¸‡à¸£à¸±à¸š 2 à¸šà¸£à¸£à¸—à¸±à¸” */
Â  Â  Â  min-height: 70px;
Â  Â  }

Â  Â  .summary-table td {
Â  Â  Â  padding: 6px;
Â  Â  Â  border: 1px solid #f8bbd0;
Â  Â  Â  color: black;
Â  Â  Â  /* white-space: nowrap; <--- à¸¥à¸šà¸­à¸­à¸ à¸«à¸£à¸·à¸­à¸à¸³à¸«à¸™à¸”à¹€à¸‰à¸à¸²à¸°à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚ */
Â  Â  Â  overflow: hidden;
Â  Â  Â  text-overflow: ellipsis;
Â  Â  }

Â  Â  /* âœ… à¹€à¸à¸´à¹ˆà¸¡: à¸„à¸¥à¸²à¸ªà¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸‹à¸¥à¸¥à¹Œà¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚ (à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸”à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹„à¸”à¹‰à¸à¸­à¸”à¸µ) */
Â  Â  .summary-table .number-cell {
Â  Â  Â  white-space: nowrap; /* à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¹€à¸¥à¸‚à¹à¸ªà¸”à¸‡à¹ƒà¸™ 1 à¸šà¸£à¸£à¸—à¸±à¸” */
Â  Â  Â  text-align: right !important; /* à¸ˆà¸±à¸”à¸Šà¸´à¸”à¸‚à¸§à¸² */
Â  Â  }
Â  Â  
Â  Â  .summary-table .province-cell {
Â  Â  Â  white-space: normal; /* à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸•à¸±à¸”à¸„à¸³à¸ªà¸³à¸«à¸£à¸±à¸šà¸Šà¸·à¹ˆà¸­à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” */
Â  Â  Â  text-align: left !important;
Â  Â  }


Â  Â  .summary-table tr:nth-child(even) { background-color: #fce4ec; }
Â  Â  .summary-table tr:nth-child(odd) { background-color: white; }

Â  Â  .province-link {
Â  Â  Â  color: blue;
Â  Â  Â  text-decoration: underline;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .province-link:hover { color: darkblue; }

Â  Â  #studyCenterTable tbody tr { cursor: pointer; }
Â  Â  #studyCenterTable tbody tr:hover { background-color: #e0e0e0 !important; }
Â  Â  #studyCenterTable tbody tr.selected-row {
Â  Â  Â  background-color: #d1e7fd !important;
Â  Â  Â  font-weight: bold;
Â  Â  }

Â  Â  .clickable-header { cursor: pointer; }
Â  Â  .clickable-header:hover { color: #555; }

Â  Â  .center-name-link { color: blue; text-decoration: underline; }

Â  Â  .align-left { text-align: left !important; }
Â  Â  .align-center { text-align: center !important; }
Â  Â  .align-right { text-align: right !important; }

Â  Â  #log {
Â  Â  Â  color: navy;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-top: 15px;
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 1.1rem;
Â  Â  }

Â  Â  @media (max-width: 1024px) {
Â  Â  Â  .header-text h1 { font-size: 2rem; }
Â  Â  Â  .header-text h2 { font-size: 1.2rem; }
Â  Â  Â  .cards { flex-direction: column; }
Â  Â  Â  .province-table-wrapper { margin-left: 0; overflow-x:auto; }
Â  Â  Â  /* à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸” th/td à¹ƒà¸«à¹‰à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸à¸±à¸šà¸¡à¸·à¸­à¸–à¸·à¸­ */
Â  Â  Â  .summary-table th, .summary-table td { padding: 4px; font-size: 0.75rem; height: 60px; }
Â  Â  }

Â  Â  .dataTables_scrollHeadInner { width: 100% !important; }
Â  </style>
</head>

<body>
Â  <div class="dashboard-container scale-control">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-text">
Â  Â  Â  Â  <h1><span style="color: navy;">CDD</span><span style="color: deeppink;">Women</span><span style="color: red;">Fund</span></h1>
Â  Â  Â  Â  <h2><span style="color: black;">à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ </span><span style="color: deeppink;">à¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸°à¹€à¸—à¸¨ </span><span style="color: red;" id="province-title">à¸£à¸²à¸¢à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</span></h2>
Â  Â  Â  Â  <div style="color: navy; font-weight: bold; font-size: 1.5rem; margin-top: 1rem;">
Â  Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸à¸­à¸‡à¸—à¸¸à¸™à¸à¸±à¸’à¸™à¸²à¸šà¸—à¸šà¸²à¸—à¸ªà¸•à¸£à¸µà¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸°à¹€à¸—à¸¨
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="logo-container">
Â  Â  Â  Â  <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo" width="60" height="140" />
Â  Â  Â  Â  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Additional Logo" />
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div style="color: navy; font-weight: bold; text-align: right; font-size: 1.5rem; margin-top: 1rem;">
Â  Â  Â  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¸“ à¸§à¸±à¸™à¸—à¸µà¹ˆ 30 à¸à¸±à¸™à¸¢à¸²à¸¢à¸™ 2568
Â  Â  </div>

Â  Â  <div id="log">ğŸ”„ à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”...</div>

Â  Â  Â  Â  <div class="cards">
Â  Â  Â  <div class="card pink">
Â  Â  Â  Â  à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£<div class="value" id="num-projects">-</div>
Â  Â  Â  Â  à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´<div class="value" id="approved-money-card1">-</div>
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 1 à¸•.à¸„. 2568<div class="value" id="debt-start-card1">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card light-pink">
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸)<div class="value" id="debt-now-card2">-</div>
Â  Â  Â  Â  à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™<div class="value" id="recovered-principal">-</div>
Â  Â  Â  Â  à¸«à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¶à¸‡à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (à¸‚)<div class="value" id="not-due-card2">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card orange">
Â  Â  Â  Â  à¸à¸²à¸£à¹„à¸à¸¥à¹ˆà¹€à¸à¸¥à¸µà¹ˆà¸¢à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸”à¸µà¹„à¸”à¹‰ (à¸„)<div class="value" id="mediation">-</div>
Â  Â  Â  Â  à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸­à¸±à¸¢à¸à¸²à¸£à¸£à¸±à¸šà¹€à¸£à¸·à¹ˆà¸­à¸‡(à¸‡1)<div class="value" id="prosecutor">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¸›à¸£à¸°à¸—à¸±à¸šà¸£à¸±à¸šà¸Ÿà¹‰à¸­à¸‡(à¸‡2)<div class="value" id="court-filed">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¹„à¸”à¹‰à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰(à¸‡3)<div class="value" id="court-judgement">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¸•à¸²à¸¡à¸¢à¸­à¸¡(à¸‡4)<div class="value" id="court-consent">-</div>
Â  Â  Â  Â  à¸›.à¸§à¸´ à¹à¸à¹ˆà¸‡ à¸¡à¸²à¸•à¸£à¸² 20 à¸•à¸£à¸µ(à¸‡5)<div class="value" id="civil-law-20">-</div>
Â  Â  Â  Â  à¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µà¸­à¸²à¸à¸²(à¸‡6)<div class="value" id="criminal-action">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card pastel-pink">
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸²à¸¡à¸à¸à¸«à¸¡à¸²à¸¢ (à¸‡)<div class="value" id="legal-card4">-</div>
Â  Â  Â  Â  à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸•à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µ<div class="value" id="principal-legal">-</div>
Â  Â  Â  Â  à¸ˆà¸³à¸™à¸§à¸™à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸£<div class="value" id="overdue-legal">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card deep-pastel-pink">
Â  Â  Â  Â  à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (B)<div class="value" id="overdue-card5">-</div>
Â  Â  Â  Â  à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°<div class="value" id="percent-overdue-card5">-</div>
Â  Â  Â  Â  à¸ˆà¸šà¸ªà¸±à¸à¸à¸²à¸¡à¸µà¸«à¸™à¸µà¹‰à¸„à¹‰à¸²à¸‡ à¸•à¸´à¸”à¸•à¸²à¸¡à¹€à¸£à¹ˆà¸‡à¸”à¹ˆà¸§à¸™<div class="value" id="contract-end-debt">-</div>
Â  Â  Â  Â  à¸¡à¸µà¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸£à¹‰à¸­à¸¢à¸¥à¸° 5 à¸•à¸´à¸”à¸•à¸²à¸¡à¹ƒà¸à¸¥à¹‰à¸Šà¸´à¸”<div class="value" id="over-5-percent">-</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="main-visuals">
Â  Â  Â  <div class="left">
Â  Â  Â  Â  <div class="section-title">10 à¸­à¸±à¸™à¸”à¸±à¸š à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”</div>
Â  Â  Â  Â  <canvas id="donutChart"></canvas>
Â  Â  Â  </div>

Â  Â  Â  <div class="center">
Â  Â  Â  Â  <img src="https://i.postimg.cc/pTR4HCg3/women5-copy.png" alt="à¸ à¸²à¸à¸œà¸¹à¹‰à¸«à¸à¸´à¸‡" style="width: 400px; height: auto;" />
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="province-table-wrapper">
Â  Â  Â  <table class="summary-table" id="provinceTable" style="width:100%;">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  </table>
Â  Â  </div>
Â  </div>

<script>
/* ==============================
Â  Â ğŸ§  à¸£à¸°à¸šà¸š Dashboard à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡
Â  Â ============================== */
const API_URL = "https://script.google.com/macros/s/AKfycbzMxEWPAJZ_6T8kUxQPGdsvbuFya-M9rpq_bIybdsQztHbfO49roTju3ABGUrp3nJcQWQ/exec";
let donutChartInstance = null;
let provinceDataTable = null;

/* === Mapping à¸„à¸µà¸¢à¹Œ â†’ à¸Šà¸·à¹ˆà¸­à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ === */
const columnMap = {
Â  province: "à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”",
Â  totalProjects: "à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£",
Â  approvedAmount: "à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´",
Â  debtStart: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 1 à¸•.à¸„. 2568",
Â  debtNow: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸)",
Â  notDue: "à¸«à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¶à¸‡à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (à¸‚)",
Â  recoveredPrincipal: "à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™",
Â  recoveredInterest: "à¸£à¸±à¸šà¸„à¸·à¸™à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢",
Â  recoveredFine: "à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸šà¸µà¹‰à¸¢à¸›à¸£à¸±à¸š",
Â  recoveredPenaltyInterest: "à¸£à¸±à¸šà¸„à¸·à¸™à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢à¸œà¸´à¸”à¸™à¸±à¸”",
Â  recoveredOverpay: "à¸£à¸±à¸šà¹€à¸‡à¸´à¸™à¹€à¸à¸´à¸™",
Â  recoveredTotal: "à¸£à¸±à¸šà¸„à¸·à¸™à¸£à¸§à¸¡",
Â  debtAsOf30968: "à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 30 à¸.à¸¢. 2568",
Â  mediation: "à¸à¸²à¸£à¹„à¸à¸¥à¹ˆà¹€à¸à¸¥à¸µà¹ˆà¸¢à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸”à¸µà¹„à¸”à¹‰ (à¸„)",
Â  prosecutor: "à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸­à¸±à¸¢à¸à¸²à¸£à¸£à¸±à¸šà¹€à¸£à¸·à¹ˆà¸­à¸‡ (à¸‡1)",
Â  courtFiled: "à¸¨à¸²à¸¥à¸›à¸£à¸°à¸—à¸±à¸šà¸£à¸±à¸šà¸Ÿà¹‰à¸­à¸‡ (à¸‡2)",
Â  courtJudgement: "à¸¨à¸²à¸¥à¹„à¸”à¹‰à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰ (à¸‡3)",
Â  courtConsent: "à¸¨à¸²à¸¥à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¸•à¸²à¸¡à¸¢à¸­à¸¡ (à¸‡4)",
Â  civilLaw20: "à¸›.à¸§à¸´ à¹à¸à¹ˆà¸‡ à¸¡.20 à¸•à¸£à¸µ (à¸‡5)",
Â  criminalAction: "à¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µà¸­à¸²à¸à¸² (à¸‡6)",
Â  legalAction: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸²à¸¡à¸à¸à¸«à¸¡à¸²à¸¢ (à¸‡)",
Â  principalLegal: "à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸•à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µ",
Â  overdueLegal: "à¸ˆà¸³à¸™à¸§à¸™à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸£",
Â  overdue: "à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (B)",
Â  overduePercent: "à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (C)",
Â  contractEndDebt: "à¸ˆà¸šà¸ªà¸±à¸à¸à¸²à¸¡à¸µà¸«à¸™à¸µà¹‰à¸„à¹‰à¸²à¸‡ à¸•à¸´à¸”à¸•à¸²à¸¡à¹€à¸£à¹ˆà¸‡à¸”à¹ˆà¸§à¸™ (D)",
Â  over5Percent: "à¸¡à¸µà¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸£à¹‰à¸­à¸¢à¸¥à¸° 5 à¸•à¸´à¸”à¸•à¸²à¸¡à¹ƒà¸à¸¥à¹‰à¸Šà¸´à¸” (E)",
Â  statusPayment: "à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰",
Â  projectStatus: "à¸ªà¸–à¸²à¸™à¸°à¹‚à¸„à¸£à¸‡à¸à¸²à¸£",
Â  notes: "à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸"
};

/* === à¸¥à¸³à¸”à¸±à¸šà¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£ === */
const orderedColumns = [
Â  "province","totalProjects","approvedAmount",
Â  "debtStart","debtNow","notDue","recoveredPrincipal",
Â  "recoveredInterest","recoveredFine","recoveredPenaltyInterest","recoveredOverpay","recoveredTotal","debtAsOf30968",
Â  "mediation","prosecutor","courtFiled","courtJudgement","courtConsent","civilLaw20","criminalAction",
Â  "legalAction","principalLegal","overdueLegal","overdue","overduePercent",
Â  "contractEndDebt","over5Percent","statusPayment","projectStatus","notes"
];

/* === à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ format à¸•à¸±à¸§à¹€à¸¥à¸‚à¹à¸¥à¸°à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œ === */
function formatNumber(num){
Â  if (num === null || num === undefined || String(num).trim() === "") return "-";
Â  const n = Number(String(num).replace(/[^0-9.-]/g,''));Â 
Â  if (!isFinite(n)) return String(num);
Â  return n.toLocaleString("th-TH");
}
function formatPercent(val){
Â  const num=parseFloat(String(val).replace(/[^0-9.-]/g,''));
Â  return isNaN(num)?"-":num.toFixed(2)+"%";
}

/* === à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸•à¸±à¸§à¹€à¸¥à¸‚à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ (à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸ªà¹ˆà¸„à¸¥à¸²à¸ª number-cell) === */
function isNumericColumn(key) {
Â  return [
Â  Â  "totalProjects", "approvedAmount", "debtStart", "debtNow", "notDue",
Â  Â  "recoveredPrincipal", "recoveredInterest", "recoveredFine", 
Â  Â  "recoveredPenaltyInterest", "recoveredOverpay", "recoveredTotal", 
Â  Â  "debtAsOf30968", "mediation", "prosecutor", "courtFiled", "courtJudgement", 
Â  Â  "courtConsent", "civilLaw20", "criminalAction", "legalAction", 
Â  Â  "principalLegal", "overdueLegal", "overdue", "contractEndDebt"
Â  ].includes(key);
}

/* === à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸ === */
async function fetchData(){
Â  const logEl=document.getElementById("log");
Â  logEl.textContent="ğŸ”„ à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”...";
Â  try{
Â  Â  const res=await fetch(API_URL);
Â  Â  const data=await res.json();
Â  Â  if(data.error){console.error("Apps Script Error:",data.error);logEl.textContent="âŒ à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ";return;}
Â  Â  const overview=data.overview||{};
Â  Â  const pieChartData=data.topOverdue||[];
Â  Â  const provinces=data.provinces||[];

Â  Â  /* === Update Cards === */
Â  Â  document.getElementById('num-projects').textContent=formatNumber(overview.B2);
Â  Â  document.getElementById('approved-money-card1').textContent=formatNumber(overview.C2);
Â  Â  document.getElementById('debt-start-card1').textContent=formatNumber(overview.D2);
Â  Â  document.getElementById('debt-now-card2').textContent=formatNumber(overview.E2);
Â  Â  document.getElementById('recovered-principal').textContent=formatNumber(overview.G2);
Â  Â  document.getElementById('not-due-card2').textContent=formatNumber(overview.F2);
Â  Â  document.getElementById('mediation').textContent=formatNumber(overview.H2);
Â  Â  document.getElementById('prosecutor').textContent=formatNumber(overview.I2);
Â  Â  document.getElementById('court-filed').textContent=formatNumber(overview.J2);
Â  Â  document.getElementById('court-judgement').textContent=formatNumber(overview.K2);
Â  Â  document.getElementById('court-consent').textContent=formatNumber(overview.L2);
Â  Â  document.getElementById('civil-law-20').textContent=formatNumber(overview.M2);
Â  Â  document.getElementById('criminal-action').textContent=formatNumber(overview.N2);
Â  Â  document.getElementById('legal-card4').textContent=formatNumber(overview.O2);
Â  Â  document.getElementById('principal-legal').textContent=formatNumber(overview.P2);
Â  Â  document.getElementById('overdue-legal').textContent=formatNumber(overview.Q2);
Â  Â  document.getElementById('overdue-card5').textContent=formatNumber(overview.R2);
Â  Â  document.getElementById('percent-overdue-card5').textContent=formatPercent(overview.S2);
Â  Â  document.getElementById('contract-end-debt').textContent=formatNumber(overview.T2);
Â  Â  document.getElementById('over-5-percent').textContent=formatPercent(overview.U2);

Â  Â  /* === Donut Chart === */
Â  Â  if(donutChartInstance) donutChartInstance.destroy();
Â  Â  const ctx=document.getElementById('donutChart').getContext('2d');
Â  Â  donutChartInstance=new Chart(ctx,{
Â  Â  Â  type:'doughnut',
Â  Â  Â  data:{
Â  Â  Â  Â  labels:pieChartData.map(p=>p.province),
Â  Â  Â  Â  datasets:[{data:pieChartData.map(p=>parseFloat(p.percent)||0),
Â  Â  Â  Â  backgroundColor:['#FF202B','#87FEBC','#FFB6B7','#FFDD63','#F68B71','#DAB9E6','#A0E8E8','#ADFF2F','#FFFF00','#FFA500']}]
Â  Â  Â  },
Â  Â  Â  options:{
Â  Â  Â  Â  responsive:true,
Â  Â  Â  Â  plugins:{
Â  Â  Â  Â  Â  legend:{position:'bottom'},
Â  Â  Â  Â  Â  tooltip:{callbacks:{label:c=>`${c.label}: ${parseFloat(c.raw).toFixed(2)}%`}}
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  });

Â  Â  /* === à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸²à¸£à¸²à¸‡ === */
Â  Â  const table=document.querySelector("#provinceTable");
Â  Â  const thead=table.querySelector("thead");
Â  Â  const tbody=table.querySelector("tbody");
Â  Â  tbody.innerHTML="";

Â  Â  if(!provinces||provinces.length===0){
Â  Â  Â  thead.innerHTML="<tr><th>à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</th><th>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</th></tr>";
Â  Â  Â  logEl.textContent="âš ï¸ à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”";
Â  Â  Â  return;
Â  Â  }

Â  Â  const responseKeys=Object.keys(provinces[0]);
Â  Â  const orderedPresent=orderedColumns.filter(k=>responseKeys.includes(k));
Â  Â  const remaining=responseKeys.filter(k=>!orderedPresent.includes(k));
Â  Â  const finalColumns=[...orderedPresent,...remaining];

Â  Â  const headerHtml=finalColumns.map(k=>{
Â  Â  Â  const label=columnMap[k]||k;
Â  Â  Â  return `<th>${label}</th>`;
Â  Â  }).join("");
Â  Â  thead.innerHTML=`<tr>${headerHtml}</tr>`;

Â  Â  provinces.forEach(p=>{
Â  Â  Â  const url=`https://tnah097.github.io/cdwomenpod-dashboard/province.html?province=${encodeURIComponent(p.province)}`;
Â  Â  Â  const rowHTML=finalColumns.map(k=>{
Â  Â  Â  Â  const raw=p[k];
Â  Â  Â  Â  let tdClass = "";
Â  Â  Â  Â  let content = "";

Â  Â  Â  Â  if(k==="province"){
Â  Â  Â  Â  Â  const display=(raw===null||raw===undefined||raw==="")?"-":raw;
Â  Â  Â  Â  Â  tdClass = "province-cell"; // à¹ƒà¸Šà¹‰à¸„à¸¥à¸²à¸ªà¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸•à¸±à¸”à¸„à¸³
Â  Â  Â  Â  Â  content = `<a href="${url}" class="province-link" target="_blank">${display}</a>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  else if(k==="overduePercent"||String(k).toLowerCase().includes("percent")){
Â  Â  Â  Â  Â  tdClass = "number-cell";
Â  Â  Â  Â  Â  content = formatPercent(raw);
Â  Â  Â  Â  }
Â  Â  Â  Â  else if(isNumericColumn(k)){
Â  Â  Â  Â  Â  tdClass = "number-cell";
Â  Â  Â  Â  Â  if(raw===null||raw===undefined||raw==="") content = "-";
Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  const numericCandidate=Number(String(raw).replace(/[^0-9.-]/g,''));
Â  Â  Â  Â  Â  Â  content = isFinite(numericCandidate) ? formatNumber(numericCandidate) : String(raw);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  // à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸•à¸±à¸§à¹€à¸¥à¸‚ (statusPayment, projectStatus, notes)
Â  Â  Â  Â  Â  tdClass = "align-left";
Â  Â  Â  Â  Â  content = (raw===null||raw===undefined||raw==="") ? "-" : String(raw);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  return `<td class="${tdClass}">${content}</td>`;
Â  Â  Â  }).join("");
Â  Â  Â  tbody.innerHTML+=`<tr>${rowHTML}</tr>`;
Â  Â  });

Â  Â  // à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡ DataTable initialization
Â  Â  if($.fn.DataTable.isDataTable('#provinceTable'))$('#provinceTable').DataTable().clear().destroy();
Â  Â  provinceDataTable=$('#provinceTable').DataTable({
Â  Â  Â  paging:false,scrollX:true,scrollY:'400px',scrollCollapse:true,
Â  Â  Â  order:[],language:{search:"à¸„à¹‰à¸™à¸«à¸²:",zeroRecords:"à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥"},
Â  Â  Â  initComplete:function(){this.api().columns.adjust();},
Â  Â  Â  // à¸à¸³à¸«à¸™à¸”à¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡à¸‚à¸­à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸”à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢à¸‚à¸¶à¹‰à¸™
Â  Â  Â  columnDefs: [
Â  Â  Â  Â  { width: '150px', targets: 0 }, // à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”: à¸à¸§à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢
Â  Â  Â  Â  { width: '80px', targets: '_all' } // à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­: à¸à¸³à¸«à¸™à¸”à¸‚à¸™à¸²à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
Â  Â  Â  ]
Â  Â  });

Â  Â  setTimeout(()=>{if(provinceDataTable&&provinceDataTable.columns)provinceDataTable.columns.adjust().draw(false);},200);

Â  Â  logEl.textContent="âœ… à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ";
Â  }catch(e){console.error(e);document.getElementById("log").textContent="âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥";}
}
fetchData();
</script>
</body>
</html>
