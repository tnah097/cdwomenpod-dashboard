<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>โปรแกรมจัดการและตัดชำระหนี้</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
  th { background-color: #f2f2f2; }
  .paid { background-color: #d0f0c0; } /* สีเขียวสำหรับงวดชำระครบ */
</style>
</head>
<body>

<h2>ตารางรายละเอียดหนี้</h2>
<table id="debtTable">
  <thead>
    <tr>
      <th>ลำดับ</th>
      <th>กำหนดวันชำระ</th>
      <th>เงินต้น</th>
      <th>ดอกเบี้ย</th>
      <th>เบี้ยปรับ</th>
      <th>ด/บ ผิดนัดเดิม</th>
      <th>ด/บ ผิดนัดใหม่</th>
      <th>รวมหนี้</th>
      <th>รับคืน ด/บ ผิดนัดเดิม</th>
      <th>รับคืน ด/บ ผิดนัดใหม่</th>
      <th>รับคืนเบี้ยปรับ</th>
    </tr>
  </thead>
  <tbody>
    <!-- แถวข้อมูลจะถูกสร้างด้วย JS -->
  </tbody>
</table>

<script>
// ใส่ข้อมูลจริงครบทุกงวด (ตัวอย่างใส่แค่ 3 แถว, สามารถเพิ่มเป็น 535 แถวได้)
const debtData = [
  {id:1,date:"2025-10-01",principal:5000,interest:50,penalty:0,oldDefault:0,newDefault:0,receivedPrincipal:5000,receivedInterest:50,receivedOldDefault:0,receivedNewDefault:0,receivedPenalty:0},
  {id:2,date:"2025-11-01",principal:5000,interest:50,penalty:0,oldDefault:0,newDefault:0,receivedPrincipal:0,receivedInterest:0,receivedOldDefault:0,receivedNewDefault:0,receivedPenalty:0},
  {id:3,date:"2025-12-01",principal:5000,interest:50,penalty:0,oldDefault:0,newDefault:0,receivedPrincipal:0,receivedInterest:0,receivedOldDefault:0,receivedNewDefault:0,receivedPenalty:0},
  // เพิ่มข้อมูลงวดต่อไปจนครบ 535 แถว
];

// ฟังก์ชันคำนวณวันผิดนัด
function calculateOverdueDays(dueDate) {
  const today = new Date();
  const due = new Date(dueDate);
  const diff = Math.floor((today - due) / (1000 * 60 * 60 * 24));
  return diff > 0 ? diff : 0;
}

// แสดงตาราง
function renderTable() {
  const tbody = document.querySelector("#debtTable tbody");
  tbody.innerHTML = "";

  debtData.forEach(inst => {
    const remainingPrincipal = inst.principal - inst.receivedPrincipal;
    const remainingInterest = inst.interest - inst.receivedInterest;
    const remainingOldDefault = inst.oldDefault - inst.receivedOldDefault;
    const remainingNewDefault = inst.newDefault - inst.receivedNewDefault;

    const isFullyPaid = remainingPrincipal <= 0.01 && remainingInterest <= 0.01 &&
                        remainingOldDefault <= 0.01 && remainingNewDefault <= 0.01;

    // คำนวณ ด/บ ผิดนัดใหม่เฉพาะงวดที่ยังไม่ได้ชำระครบ
    let calculatedNewDefault = inst.newDefault;
    if(!isFullyPaid){
      const overdueDays = calculateOverdueDays(inst.date);
      calculatedNewDefault += overdueDays * 2; // ตัวอย่าง: 2 บาทต่อวัน
    }

    const totalDebt = inst.principal + inst.interest + inst.penalty + inst.oldDefault + calculatedNewDefault;

    const row = document.createElement("tr");
    if(isFullyPaid) row.classList.add("paid");

    row.innerHTML = `
      <td>${inst.id}</td>
      <td>${inst.date}</td>
      <td>${inst.principal.toLocaleString()}</td>
      <td>${inst.interest.toLocaleString()}</td>
      <td>${inst.penalty.toLocaleString()}</td>
      <td>${inst.oldDefault.toLocaleString()}</td>
      <td>${calculatedNewDefault.toLocaleString()}</td>
      <td>${totalDebt.toLocaleString()}</td>
      <td>${inst.receivedOldDefault.toLocaleString()}</td>
      <td>${inst.receivedNewDefault.toLocaleString()}</td>
      <td>${inst.receivedPenalty.toLocaleString()}</td>
    `;
    tbody.appendChild(row);
  });
}

renderTable();
</script>
</body>
</html>
