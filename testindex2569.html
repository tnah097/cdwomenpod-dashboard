<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CDDWomenfund Dashboard ‚Äî ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ô (Realtime Polling 5s)</title>
  <!-- Libraries (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    /* ========= Theme (pastel pink-purple) ========= */
    :root{
      --pink-1:#ffe6f0;
      --pink-2:#f3e5f5;
      --pink-3:#e1bee7;
      --card-pink:#e91e63;
      --card-light-pink:#f8bbd0;
      --accent:#f06292;
      --border:#f8bbd0;
      --text-dark:#111;
    }
    html,body{height:100%;margin:0;padding:0}
    body{
      font-family: "Sarabun", Arial, sans-serif;
      background: linear-gradient(135deg,var(--pink-1) 0%, var(--pink-2) 50%, var(--pink-3) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      margin:0;
      color:var(--text-dark);
    }
    .dashboard-container{
      max-width:1500px;
      margin:16px auto;
      background: rgba(255,255,255,0.94);
      border-radius:14px;
      padding:22px 22px 36px 22px;
      box-shadow:0 8px 28px rgba(0,0,0,0.08);
      min-height:calc(100vh - 48px);
      box-sizing:border-box;
    }
    .header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;}
    .header-text{display:flex;flex-direction:column}
    h1{margin:0;font-size:2.3rem;line-height:1}
    h2{margin:4px 0 0 0;font-size:1.05rem;color:#333;line-height:1}
    .logo-container{display:flex;align-items:center;gap:12px}
    .logo-container img{height:60px}
    .info-line{color:navy;font-weight:700;text-align:right;margin-top:8px;font-size:0.95rem;}
    .cards{display:flex;gap:14px;margin-top:18px;flex-wrap:wrap}
    .card{border-radius:10px;padding:12px 12px;min-width:210px;box-sizing:border-box;color:#000;font-weight:700;display:flex;flex-direction:column;}
    .card .subtitle{font-size:0.95rem;margin:4px 0 0 0;color:#000;font-weight:700}
    .card .value{font-size:1.5rem;margin-top:6px;color:#000;font-weight:600;white-space:nowrap}
    .card.pink{background:linear-gradient(180deg,var(--card-pink),#d81b60);color:#fff}
    .card.light-pink{background:linear-gradient(180deg,var(--card-light-pink),#f3a9c6);color:#000}
    .card.orange{background:linear-gradient(180deg,#ff9800,#ffb24d);color:#000}
    .card.pastel-pink{background:linear-gradient(180deg,#fce4ec,#f6cfe0);color:#000}
    .card.deep-pastel-pink{background:linear-gradient(180deg,#f06292,#ec6790);color:#fff}
    .main-visuals{display:flex;gap:16px;align-items:flex-start;margin-top:20px;flex-wrap:wrap}
    .left,.center{flex:1;min-width:300px}
    .center img{max-width:100%;width:320px;display:block;margin:0 auto}
    #donutChart{width:100%!important;height:420px!important;max-height:520px}
    .section-title{text-align:center;font-weight:700;margin-bottom:6px}
    .province-table-wrapper{margin-top:18px;overflow:hidden}
    .summary-table{width:100%!important;border-collapse:separate;border-spacing:0;font-size:0.88rem;color:var(--text-dark);table-layout:fixed;min-width:1100px;}
    .summary-table thead th{background-color:var(--accent);color:#000;padding:10px;border:1px solid var(--border);font-weight:700;text-align:center;vertical-align:middle;white-space:normal;word-break:break-word;line-height:1.15;height:70px;min-height:70px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;padding-left:8px;padding-right:8px;}
    .summary-table thead th .th-wrap{display:block;width:100%;text-align:center;line-height:1.15;max-height:calc(2 * 1.15em);overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
    .summary-table td{padding:8px 10px;border:1px solid var(--border);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:middle;color:var(--text-dark);}
    .summary-table tr:nth-child(even){background:#fce4ec}
    .summary-table tr:nth-child(odd){background:#fff}
    .province-link{color:#0645AD;text-decoration:underline;cursor:pointer}
    .province-link:hover{color:#042a66}
    .dataTables_scrollHeadInner{width:100%!important}
    table.dataTable thead th{white-space:normal;word-break:break-word}
    @media (max-width:1200px){#donutChart{height:360px!important}.summary-table{min-width:900px}.summary-table thead th{height:64px;min-height:64px}}
    @media (max-width:900px){.header h1{font-size:1.5rem}.header h2{font-size:1rem}.cards{flex-direction:column}.main-visuals{flex-direction:column}.summary-table{min-width:740px;font-size:0.78rem}.summary-table thead th{height:60px;min-height:60px}.summary-table td{padding:6px;font-size:0.78rem}#donutChart{height:320px!important}}
    .align-left{text-align:left!important}
    .align-right{text-align:right!important}
    .align-center{text-align:center!important}
    #log{color:navy;font-weight:700;text-align:center;margin-top:10px;margin-bottom:6px}
  </style>
</head>
<body>
  <div class="dashboard-container" role="main" aria-label="CDD Women Fund Dashboard">
    <div class="header">
      <div class="header-text">
        <h1><span style="color:navy">CDD</span><span style="color:deeppink">Women</span><span style="color:red">Fund</span></h1>
        <h2><span>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span> <span style="color:deeppink">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</span></h2>
        <div style="margin-top:8px;font-weight:700;color:navy">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</div>
      </div>
      <div class="logo-container"><img src="https://i.postimg.cc/507bjy9Z/cdd.png"/><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s"/></div>
    </div>
    <div class="info-line">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 30 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2568</div>
    <div id="log">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...</div>
    <div class="cards"><div class="card pink"><div class="subtitle">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div><div class="value" id="num-projects">-</div><div class="subtitle">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div><div class="value" id="approved-money-card1">-</div><div class="subtitle">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2568</div><div class="value" id="debt-start-card1">-</div></div></div>
    <div class="main-visuals"><div class="left"><div class="section-title">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div><canvas id="donutChart"></canvas></div><div class="center"><img src="https://i.postimg.cc/pTR4HCg3/women5-copy.png"/></div></div>
    <div class="province-table-wrapper"><table class="summary-table" id="provinceTable"><thead></thead><tbody></tbody></table></div>
  </div>
  <script>
  const API_URL="https://script.google.com/macros/s/AKfycbzMxEWPAJZ_6T8kUxQPGdsvbuFya-M9rpq_bIybdsQztHbfO49roTju3ABGUrp3nJcQWQ/exec";
  const POLLING_INTERVAL_MS=5000;
  let donutChartInstance=null,provinceDataTable=null;
  const columnMap={province:"‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î",totalProjects:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",approvedAmount:"‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"};
  const orderedColumns=["province","totalProjects","approvedAmount"];
  function formatNumber(n){if(n==null)return"-";const x=Number(String(n).replace(/[^0-9.-]/g,""));return isFinite(x)?x.toLocaleString("th-TH"):n}
  async function fetchAndRender(){const l=document.getElementById("log");l.textContent="üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...";try{const r=await fetch(API_URL),d=await r.json(),p=d.provinces||[];const t=document.getElementById("provinceTable"),th=t.querySelector("thead"),tb=t.querySelector("tbody");th.innerHTML="";tb.innerHTML="";if(p.length==0){th.innerHTML="<tr><th>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th></tr>";return;}const h=document.createElement("tr");orderedColumns.forEach(k=>{const thd=document.createElement("th");thd.innerHTML='<div class="th-wrap">'+(columnMap[k]||k)+"</div>";h.appendChild(thd)});th.appendChild(h);p.forEach(r=>{const tr=document.createElement("tr");orderedColumns.forEach(k=>{const td=document.createElement("td");td.textContent=formatNumber(r[k]);tr.appendChild(td)});tb.appendChild(tr)});if($.fn.DataTable.isDataTable("#provinceTable"))$("#provinceTable").DataTable().clear().destroy();provinceDataTable=$("#provinceTable").DataTable({paging:false,scrollX:true,scrollY:"420px",scrollCollapse:true,order:[],language:{search:"‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:",zeroRecords:"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"},initComplete:function(){this.api().columns.adjust();}});setTimeout(()=>{if(provinceDataTable&&provinceDataTable.columns)provinceDataTable.columns.adjust().draw(false)},200);l.textContent="‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"}catch(e){console.error(e);document.getElementById("log").textContent="‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"}}
  (function(){fetchAndRender();setInterval(fetchAndRender,POLLING_INTERVAL_MS)})();
  </script>
</body>
</html>
