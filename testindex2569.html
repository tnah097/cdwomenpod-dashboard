<!DOCTYPE html>
<html lang="th">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>CDDWomenfund Dashboard</title>

Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
Â  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
Â  Â  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
Â  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

Â  <style>
Â  Â  /* ğŸŒ¸ à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸à¸²à¸ªà¹€à¸—à¸¥à¸Šà¸¡à¸à¸¹-à¸¡à¹ˆà¸§à¸‡ (à¸«à¹‰à¸²à¸¡à¹à¸à¹‰à¹„à¸‚) */
Â  Â  body {
Â  Â  Â  font-family: 'Sarabun', sans-serif;
Â  Â  Â  margin: 0;
Â  Â  Â  background: linear-gradient(to bottom right, #ffe6f0, #f3e5f5, #e1bee7);
Â  Â  Â  background-attachment: fixed;
Â  Â  Â  color: #000;
Â  Â  }

Â  Â  .dashboard-container {
Â  Â  Â  padding: 40px;
Â  Â  Â  background-color: rgba(255, 255, 255, 0.9);
Â  Â  Â  min-height: 100vh;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  .scale-control { font-size: 1rem; }

Â  Â  .header {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: flex-start;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  .header-text h1 { margin: 0; font-size: 2.5rem; }
Â  Â  .header-text h2 { margin: 0; font-size: 1.5rem; }
Â  Â  /* à¹‚à¸¥à¹‚à¸à¹‰: à¸–à¸¹à¸à¸„à¸§à¸šà¸„à¸¸à¸¡à¸”à¹‰à¸§à¸¢à¸ªà¹ˆà¸§à¸™à¸™à¸µà¹‰ */
Â  Â  .logo-container img { height: 60px; margin-left: 10px; }

Â  Â  /* Cards (à¸«à¹‰à¸²à¸¡à¹à¸à¹‰à¹„à¸‚) */
Â  Â  .cards { display: flex; gap: 20px; margin-top: 30px; flex-wrap: wrap; }
Â  Â  .card { flex: 1; min-width: 250px; padding: 20px; border-radius: 12px; color: white; font-weight: bold; }
Â  Â  .card .value { font-size: 1.75rem; color: black; margin-top: 10px; font-weight: normal; white-space: nowrap; }
Â  Â  .card.pink { background-color: #e91e63; flex: 0 0 auto; width: auto; }
Â  Â  .card.light-pink { background-color: #f8bbd0; }
Â  Â  .card.orange { background-color: #ff9800; }
Â  Â  .card.pastel-pink { background-color: #FFAFB0; }
Â  Â  .card.deep-pastel-pink { background-color: #f06292; }

Â  Â  .main-visuals { display: flex; margin-top: 30px; gap: 20px; flex-wrap: wrap; align-items: flex-start; }
Â  Â  .left, .center, .right { flex: 1; min-width: 300px; }
Â  Â  .center { text-align: center; }
Â  Â  canvas { max-width: 100%; }
Â  Â  #donutChart { height: 500px !important; }
Â  Â  .section-title { text-align: center; font-weight: bold; margin: 10px 0; font-size: 1.2rem; }
Â  Â  .center img { width: 250px; display: block; margin: 0 auto 10px; }

Â  Â  /* --------------------
Â  Â  Â  Â à¸•à¸²à¸£à¸²à¸‡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” â€” à¹à¸à¹‰à¹„à¸‚à¹€à¸à¸·à¹ˆà¸­à¸¥à¹‡à¸­à¸à¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡
Â  Â  Â  Â -------------------- */
.province-table-wrapper {
Â  /* âœ… à¹à¸à¹‰à¹„à¸‚: à¸•à¹‰à¸­à¸‡à¸¡à¸µ max-height à¹à¸¥à¸° overflow: auto à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹€à¸à¸´à¸” scrollbar à¸ à¸²à¸¢à¹ƒà¸™à¹à¸¥à¸°à¸£à¸­à¸‡à¸£à¸±à¸š sticky header */
Â  overflow: auto;
Â  max-height: 520px; /* à¸ˆà¸³à¸à¸±à¸”à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹à¸ªà¸”à¸‡à¸•à¸²à¸£à¸²à¸‡ */
Â  position: relative;
Â  margin-top: 30px;
Â  margin-left: 3cm;
Â  text-align: left !important;
}

.summary-table {
Â  width: max-content;
Â  border-collapse: separate; 
Â  border-spacing: 0;
Â  table-layout: auto;
Â  font-size: 0.85rem;
Â  color: black;
Â  white-space: nowrap;
}

.summary-table thead th {
Â  /* âœ… à¹à¸à¹‰à¹„à¸‚: CSS à¸ªà¸³à¸«à¸£à¸±à¸šà¸¥à¹‡à¸­à¸à¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡ (Fixed Header) */
Â  position: sticky;
Â  top: 0; /* à¸¥à¹‡à¸­à¸à¹„à¸§à¹‰à¸—à¸µà¹ˆà¸”à¹‰à¸²à¸™à¸šà¸™à¸ªà¸¸à¸”à¸‚à¸­à¸‡ wrapper */
Â  z-index: 20; /* à¹ƒà¸«à¹‰à¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡à¸­à¸¢à¸¹à¹ˆà¹€à¸«à¸™à¸·à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸§à¸¥à¸² scroll */
Â  
Â  background-color: #f06292; /* à¸ªà¸µà¸«à¸±à¸§ (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
Â  border: 1px solid #f8bbd0;
Â  padding: 10px 12px;
Â  font-weight: bold;
Â  text-align: center;
Â  vertical-align: middle;
Â  white-space: normal; /* à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸«à¸±à¸§à¸‚à¹‰à¸­ 2 à¸šà¸£à¸£à¸—à¸±à¸”à¸—à¸³à¸‡à¸²à¸™ */
}


Â  Â  /* à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹€à¸‹à¸¥à¸¥à¹Œ (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
Â  Â  .summary-table tbody td {
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  border: 1px solid #f8bbd0;
Â  Â  Â  color: black;
Â  Â  Â  text-align: center;Â  Â  Â  
Â  Â  Â  vertical-align: middle;Â 
Â  Â  Â  white-space: nowrap;Â  Â  Â 
Â  Â  Â  overflow: visible;Â  Â  Â  Â 
Â  Â  }

Â  Â  .summary-table tr:nth-child(even) { background-color: #fce4ec; }
Â  Â  .summary-table tr:nth-child(odd) { background-color: white; }

Â  Â  .province-link { color: blue; text-decoration: underline; cursor: pointer; display:inline-block; }
Â  Â  .province-link:hover { color: darkblue; }

Â  Â  .align-left { text-align: left !important; }
Â  Â  .align-center { text-align: center !important; }
Â  Â  .align-right { text-align: right !important; }

Â  Â  /* responsive tweaks (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
Â  Â  @media (max-width: 1024px) {
Â  Â  Â  .header-text h1 { font-size: 2rem; }
Â  Â  Â  .header-text h2 { font-size: 1.2rem; }
Â  Â  Â  .cards { flex-direction: column; }
Â  Â  Â  .province-table-wrapper { margin-left: 0; max-width: 100%; }
Â  Â  Â  .summary-table thead th, .summary-table tbody td { padding: 6px 8px; font-size: 0.75rem; }
Â  Â  }

Â  Â  .dataTables_wrapper .dataTables_filter { float: right; }
Â  Â  .dataTables_wrapper .dataTables_info { margin-top: 8px; }

Â  </style>
</head>

<body>
Â  <div class="dashboard-container scale-control">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-text">
Â  Â  Â  Â  <h1><span style="color: navy;">CDD</span><span style="color: deeppink;">Women</span><span style="color: red;">Fund</span></h1>
Â  Â  Â  Â  <h2><span style="color: black;">à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ </span><span style="color: deeppink;">à¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸°à¹€à¸—à¸¨ </span><span style="color: red;" id="province-title">à¸£à¸²à¸¢à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</span></h2>
Â  Â  Â  Â  <div style="color: navy; font-weight: bold; font-size: 1.5rem; margin-top: 1rem;">
Â  Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸à¸­à¸‡à¸—à¸¸à¸™à¸à¸±à¸’à¸™à¸²à¸šà¸—à¸šà¸²à¸—à¸ªà¸•à¸£à¸µà¸£à¸°à¸”à¸±à¸šà¸›à¸£à¸°à¹€à¸—à¸¨
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="logo-container">
Â  Â  Â  Â  <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo" width="60" height="140" />
Â  Â  Â  Â  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Additional Logo" />
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div style="color: navy; font-weight: bold; text-align: right; font-size: 1.5rem; margin-top: 1rem;">
Â  Â  Â  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¸“ à¸§à¸±à¸™à¸—à¸µà¹ˆ 30 à¸à¸±à¸™à¸¢à¸²à¸¢à¸™ 2568
Â  Â  </div>

Â  Â  <div id="log">ğŸ”„ à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”...</div>

Â  Â  Â  Â  <div class="cards">
Â  Â  Â  <div class="card pink">
Â  Â  Â  Â  à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£<div class="value" id="num-projects">-</div>
Â  Â  Â  Â  à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´<div class="value" id="approved-money-card1">-</div>
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 1 à¸•.à¸„. 2568<div class="value" id="debt-start-card1">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card light-pink">
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸)<div class="value" id="debt-now-card2">-</div>
Â  Â  Â  Â  à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™<div class="value" id="recovered-principal">-</div>
Â  Â  Â  Â  à¸«à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¶à¸‡à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (à¸‚)<div class="value" id="not-due-card2">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card orange">
Â  Â  Â  Â  à¸à¸²à¸£à¹„à¸à¸¥à¹ˆà¹€à¸à¸¥à¸µà¹ˆà¸¢à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸”à¸µà¹„à¸”à¹‰ (à¸„)<div class="value" id="mediation">-</div>
Â  Â  Â  Â  à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸­à¸±à¸¢à¸à¸²à¸£à¸£à¸±à¸šà¹€à¸£à¸·à¹ˆà¸­à¸‡(à¸‡1)<div class="value" id="prosecutor">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¸›à¸£à¸°à¸—à¸±à¸šà¸£à¸±à¸šà¸Ÿà¹‰à¸­à¸‡(à¸‡2)<div class="value" id="court-filed">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¹„à¸”à¹‰à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰(à¸‡3)<div class="value" id="court-judgement">-</div>
Â  Â  Â  Â  à¸¨à¸²à¸¥à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¸•à¸²à¸¡à¸¢à¸­à¸¡(à¸‡4)<div class="value" id="court-consent">-</div>
Â  Â  Â  Â  à¸›.à¸§à¸´ à¹à¸à¹ˆà¸‡ à¸¡à¸²à¸•à¸£à¸² 20 à¸•à¸£à¸µ(à¸‡5)<div class="value" id="civil-law-20">-</div>
Â  Â  Â  Â  à¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µà¸­à¸²à¸à¸²(à¸‡6)<div class="value" id="criminal-action">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card pastel-pink">
Â  Â  Â  Â  à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸²à¸¡à¸à¸à¸«à¸¡à¸²à¸¢ (à¸‡)<div class="value" id="legal-card4">-</div>
Â  Â  Â  Â  à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸•à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µ<div class="value" id="principal-legal">-</div>
Â  Â  Â  Â  à¸ˆà¸³à¸™à¸§à¸™à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸£<div class="value" id="overdue-legal">-</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="card deep-pastel-pink">
Â  Â  Â  Â  à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (B)<div class="value" id="overdue-card5">-</div>
Â  Â  Â  Â  à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°<div class="value" id="percent-overdue-card5">-</div>
Â  Â  Â  Â  à¸ˆà¸šà¸ªà¸±à¸à¸à¸²à¸¡à¸µà¸«à¸™à¸µà¹‰à¸„à¹‰à¸²à¸‡ à¸•à¸´à¸”à¸•à¸²à¸¡à¹€à¸£à¹ˆà¸‡à¸”à¹ˆà¸§à¸™<div class="value" id="contract-end-debt">-</div>
Â  Â  Â  Â  à¸¡à¸µà¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸£à¹‰à¸­à¸¢à¸¥à¸° 5 à¸•à¸´à¸”à¸•à¸²à¸¡à¹ƒà¸à¸¥à¹‰à¸Šà¸´à¸”<div class="value" id="over-5-percent">-</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="main-visuals">
Â  Â  Â  <div class="left">
Â  Â  Â  Â  <div class="section-title">10 à¸­à¸±à¸™à¸”à¸±à¸š à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”</div>
Â  Â  Â  Â  <canvas id="donutChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  <div class="center">
Â  Â  Â  Â  <img src="https://i.postimg.cc/pTR4HCg3/women5-copy.png" alt="à¸ à¸²à¸à¸œà¸¹à¹‰à¸«à¸à¸´à¸‡" style="width: 400px; height: auto;" />
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="province-table-wrapper" id="provinceTableWrapper">
Â  Â  Â  <table class="summary-table" id="provinceTable" role="grid" aria-describedby="log">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  </table>
Â  Â  </div>

Â  </div>

<script>
/* ==============================
Â  Â ğŸ§  Dashboard â€” à¹‚à¸„à¹‰à¸” JavaScript
Â  Â ============================== */

const API_URL = "https://script.google.com/macros/s/AKfycbzMxEWPAJZ_6T8kUxQPGdsvbuFya-M9rpq_bIybdsQztHbfO49roTju3ABGUrp3nJcQWQ/exec";

let donutChartInstance = null;
let provinceDataTable = null;

/* Mapping à¸„à¸µà¸¢à¹Œ â†’ à¸Šà¸·à¹ˆà¸­à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
const columnMap = {
Â  province: "à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”",
Â  totalProjects: "à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£",
Â  approvedAmount: "à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´",
Â  debtStart: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 1 à¸•.à¸„. 2568",
Â  debtNow: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸)",
Â  notDue: "à¸«à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¶à¸‡à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (à¸‚)",
Â  recoveredPrincipal: "à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™",
Â  recoveredInterest: "à¸£à¸±à¸šà¸„à¸·à¸™à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢",
Â  recoveredFine: "à¸£à¸±à¸šà¸„à¸·à¸™à¹€à¸šà¸µà¹‰à¸¢à¸›à¸£à¸±à¸š",
Â  recoveredPenaltyInterest: "à¸£à¸±à¸šà¸„à¸·à¸™à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢à¸œà¸´à¸”à¸™à¸±à¸”",
Â  recoveredOverpay: "à¸£à¸±à¸šà¹€à¸‡à¸´à¸™à¹€à¸à¸´à¸™",
Â  recoveredTotal: "à¸£à¸±à¸šà¸„à¸·à¸™à¸£à¸§à¸¡",
Â  debtAsOf30968: "à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ à¸“ 30 à¸.à¸¢. 2568",
Â  mediation: "à¸à¸²à¸£à¹„à¸à¸¥à¹ˆà¹€à¸à¸¥à¸µà¹ˆà¸¢à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸”à¸µà¹„à¸”à¹‰ (à¸„)",
Â  prosecutor: "à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸­à¸±à¸¢à¸à¸²à¸£à¸£à¸±à¸šà¹€à¸£à¸·à¹ˆà¸­à¸‡ (à¸‡1)",
Â  courtFiled: "à¸¨à¸²à¸¥à¸›à¸£à¸°à¸—à¸±à¸šà¸£à¸±à¸šà¸Ÿà¹‰à¸­à¸‡ (à¸‡2)",
Â  courtJudgement: "à¸¨à¸²à¸¥à¹„à¸”à¹‰à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰ (à¸‡3)",
Â  courtConsent: "à¸¨à¸²à¸¥à¸¡à¸µà¸„à¸³à¸à¸´à¸à¸²à¸à¸©à¸²à¸•à¸²à¸¡à¸¢à¸­à¸¡ (à¸‡4)",
Â  civilLaw20: "à¸›.à¸§à¸´ à¹à¸à¹ˆà¸‡ à¸¡.20 à¸•à¸£à¸µ (à¸‡5)",
Â  criminalAction: "à¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µà¸­à¸²à¸à¸² (à¸‡6)",
Â  legalAction: "à¸¥à¸¹à¸à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸²à¸¡à¸à¸à¸«à¸¡à¸²à¸¢ (à¸‡)",
Â  principalLegal: "à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸•à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸”à¸³à¹€à¸™à¸´à¸™à¸„à¸”à¸µ",
Â  overdueLegal: "à¸ˆà¸³à¸™à¸§à¸™à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸°à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸£",
Â  overdue: "à¸«à¸™à¸µà¹‰à¸—à¸µà¹ˆà¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (B)",
Â  overduePercent: "à¸£à¹‰à¸­à¸¢à¸¥à¸°à¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”à¸Šà¸³à¸£à¸° (C)",
Â  contractEndDebt: "à¸ˆà¸šà¸ªà¸±à¸à¸à¸²à¸¡à¸µà¸«à¸™à¸µà¹‰à¸„à¹‰à¸²à¸‡ à¸•à¸´à¸”à¸•à¸²à¸¡à¹€à¸£à¹ˆà¸‡à¸”à¹ˆà¸§à¸™ (D)",
Â  over5Percent: "à¸¡à¸µà¸«à¸™à¸µà¹‰à¹€à¸à¸´à¸™à¸£à¹‰à¸­à¸¢à¸¥à¸° 5 à¸•à¸´à¸”à¸•à¸²à¸¡à¹ƒà¸à¸¥à¹‰à¸Šà¸´à¸” (E)",
Â  statusPayment: "à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸Šà¸³à¸£à¸°à¸«à¸™à¸µà¹‰",
Â  projectStatus: "à¸ªà¸–à¸²à¸™à¸°à¹‚à¸„à¸£à¸‡à¸à¸²à¸£",
Â  notes: "à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸"
};

/* à¸¥à¸³à¸”à¸±à¸šà¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£ (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
const orderedColumns = [
Â  "province","totalProjects","approvedAmount",
Â  "debtStart","debtNow","notDue","recoveredPrincipal",
Â  "recoveredInterest","recoveredFine","recoveredPenaltyInterest","recoveredOverpay","recoveredTotal","debtAsOf30968",
Â  "mediation","prosecutor","courtFiled","courtJudgement","courtConsent","civilLaw20","criminalAction",
Â  "legalAction","principalLegal","overdueLegal","overdue","overduePercent",
Â  "contractEndDebt","over5Percent","statusPayment","projectStatus","notes"
];

/* Format helpers (à¸„à¸‡à¹€à¸”à¸´à¸¡) */
function formatNumber(num){
Â  if (num === null || num === undefined || String(num).trim() === "") return "-";
Â  const n = Number(String(num).replace(/[^0-9.-]/g,''));Â 
Â  if (!isFinite(n)) return String(num);
Â  return n.toLocaleString("th-TH");
}
function formatPercent(val){
Â  const num=parseFloat(String(val).replace(/[^0-9.-]/g,''));
Â  return isNaN(num)?"-":num.toFixed(2)+"%";
}

/* à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸«à¸¥à¸±à¸ */
async function fetchData(){
Â  const logEl=document.getElementById("log");
Â  logEl.textContent="ğŸ”„ à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”...";
Â  try{
Â  Â  const res=await fetch(API_URL);
Â  Â  const data=await res.json();
Â  Â  if(data.error){ console.error("Apps Script Error:",data.error); logEl.textContent="âŒ à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ"; return; }

Â  Â  const overview=data.overview||{};
Â  Â  const pieChartData=data.topOverdue||[];
Â  Â  const provinces=data.provinces||[];

Â  Â  /* === Update Cards (à¸„à¸‡à¹€à¸”à¸´à¸¡) === */
Â  Â  document.getElementById('num-projects').textContent=formatNumber(overview.B2);
Â  Â  document.getElementById('approved-money-card1').textContent=formatNumber(overview.C2);
Â  Â  document.getElementById('debt-start-card1').textContent=formatNumber(overview.D2);
Â  Â  document.getElementById('debt-now-card2').textContent=formatNumber(overview.E2);
Â  Â  document.getElementById('recovered-principal').textContent=formatNumber(overview.G2);
Â  Â  document.getElementById('not-due-card2').textContent=formatNumber(overview.F2);
Â  Â  document.getElementById('mediation').textContent=formatNumber(overview.H2);
Â  Â  document.getElementById('prosecutor').textContent=formatNumber(overview.I2);
Â  Â  document.getElementById('court-filed').textContent=formatNumber(overview.J2);
Â  Â  document.getElementById('court-judgement').textContent=formatNumber(overview.K2);
Â  Â  document.getElementById('court-consent').textContent=formatNumber(overview.L2);
Â  Â  document.getElementById('civil-law-20').textContent=formatNumber(overview.M2);
Â  Â  document.getElementById('criminal-action').textContent=formatNumber(overview.N2);
Â  Â  document.getElementById('legal-card4').textContent=formatNumber(overview.O2);
Â  Â  document.getElementById('principal-legal').textContent=formatNumber(overview.P2);
Â  Â  document.getElementById('overdue-legal').textContent=formatNumber(overview.Q2);
Â  Â  document.getElementById('overdue-card5').textContent=formatNumber(overview.R2);
Â  Â  document.getElementById('percent-overdue-card5').textContent=formatPercent(overview.S2);
Â  Â  document.getElementById('contract-end-debt').textContent=formatNumber(overview.T2);
Â  Â  document.getElementById('over-5-percent').textContent=formatPercent(overview.U2);

Â  Â  /* === Donut Chart (à¸„à¸‡à¹€à¸”à¸´à¸¡) === */
Â  Â  if(donutChartInstance) donutChartInstance.destroy();
Â  Â  const ctx=document.getElementById('donutChart').getContext('2d');
Â  Â  donutChartInstance=new Chart(ctx,{
Â  Â  Â  type:'doughnut',
Â  Â  Â  data:{
Â  Â  Â  Â  labels:pieChartData.map(p=>p.province),
Â  Â  Â  Â  datasets:[{
Â  Â  Â  Â  Â  data:pieChartData.map(p=>parseFloat(p.percent)||0),
Â  Â  Â  Â  Â  backgroundColor:['#FF202B','#87FEBC','#FFB6B7','#FFDD63','#F68B71','#DAB9E6','#A0E8E8','#ADFF2F','#FFFF00','#FFA500']
Â  Â  Â  Â  }]
Â  Â  Â  },
Â  Â  Â  options:{
Â  Â  Â  Â  responsive:true,
Â  Â  Â  Â  plugins:{
Â  Â  Â  Â  Â  legend:{position:'bottom'},
Â  Â  Â  Â  Â  tooltip:{callbacks:{label:c=>`${c.label}: ${parseFloat(c.raw).toFixed(2)}%`}}
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  });

Â  Â  /* === à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸²à¸£à¸²à¸‡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” (à¸„à¸‡à¹€à¸”à¸´à¸¡ logic) === */
Â  Â  const table=document.querySelector("#provinceTable");
Â  Â  const thead=table.querySelector("thead");
Â  Â  const tbody=table.querySelector("tbody");
Â  Â  tbody.innerHTML="";

Â  Â  if(!provinces||provinces.length===0){
Â  Â  Â  thead.innerHTML="<tr><th>à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</th><th>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</th></tr>";
Â  Â  Â  logEl.textContent="âš ï¸ à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”";
Â  Â  Â  return;
Â  Â  }

Â  Â  const responseKeys=Object.keys(provinces[0]);
Â  Â  const orderedPresent=orderedColumns.filter(k=>responseKeys.includes(k));
Â  Â  const remaining=responseKeys.filter(k=>!orderedPresent.includes(k));
Â  Â  const finalColumns=[...orderedPresent,...remaining];

Â  Â  const headerHtml=finalColumns.map(k=>{
Â  Â  Â  const label=columnMap[k]||k;
Â  Â  Â  return `<th>${label}</th>`;
Â  Â  }).join("");
Â  Â  thead.innerHTML=`<tr>${headerHtml}</tr>`;

Â  Â  provinces.forEach(p=>{
Â  Â  Â  const url=`province2569.html?province=${encodeURIComponent(p.province||"")}`;
Â  Â  Â  const rowHTML=finalColumns.map(k=>{
Â  Â  Â  Â  const raw=p[k];
Â  Â  Â  Â  if(k==="province"){
Â  Â  Â  Â  Â  const display=(raw===null||raw===undefined||raw==="")?"-":raw;
Â  Â  Â  Â  Â  return `<td class="align-center"><a href="${url}" class="province-link" target="_blank" rel="noopener noreferrer">${display}</a></td>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  if(k==="overduePercent"||String(k).toLowerCase().includes("percent")){
Â  Â  Â  Â  Â  return `<td class="align-center">${formatPercent(raw)}</td>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  if(raw===null||raw===undefined||raw==="") return `<td class="align-center">-</td>`;
Â  Â  Â  Â  const numericCandidate=Number(String(raw).replace(/[^0-9.-]/g,''));
Â  Â  Â  Â  if(isFinite(numericCandidate)){
Â  Â  Â  Â  Â  return `<td class="align-center">${formatNumber(numericCandidate)}</td>`;
Â  Â  Â  Â  }else{
Â  Â  Â  Â  Â  return `<td class="align-center">${String(raw)}</td>`;
Â  Â  Â  Â  }
Â  Â  Â  }).join("");
Â  Â  Â  tbody.innerHTML+=`<tr>${rowHTML}</tr>`;
Â  Â  });

Â  Â  /* === DataTable initialization (à¸›à¸£à¸±à¸šà¹ƒà¸«à¹‰à¸—à¸³à¸‡à¸²à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸š CSS Sticky) === */
Â  Â  if($.fn.DataTable.isDataTable('#provinceTable')) $('#provinceTable').DataTable().clear().destroy();

provinceDataTable = $('#provinceTable').DataTable({
Â  paging:false,
Â  autoWidth:false, 
Â  order:[],
Â  language:{ search:"à¸„à¹‰à¸™à¸«à¸²:", zeroRecords:"à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥" },
Â  initComplete:function(){
Â  Â  const api=this.api();
Â  Â  setTimeout(()=>{Â 
Â  Â  Â  try{ api.columns().adjust().draw(false); }catch(e){}Â 
Â  Â  }, 100);
Â  }
});

Â  Â  logEl.textContent="âœ… à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ à¸²à¸à¸£à¸§à¸¡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ";
Â  }catch(e){
Â  Â  console.error(e);
Â  Â  document.getElementById("log").textContent="âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥";
Â  }
}

fetchData();
</script>
</body>
</html>
