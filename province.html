<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>CD Women POD Dashboard</title>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css" />

    <style>
        /* ========================
           üíÖ Global Styles
           ======================== */
        body {
            font-family: 'Sarabun', sans-serif;
            margin: 0;
            background: url('https://www.dga.or.th/wp-content/uploads/2025/06/20250612_074641550_iOS-1120x746.jpg') center/cover no-repeat;
            background-attachment: fixed;
            color: #000;
        }

        .dashboard-container {
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.9);
            width: 100%;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* ========================
           üñºÔ∏è Header Section
           ======================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .header-text h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .header-text h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .logo-container img {
            height: 60px;
            margin-left: 10px;
        }

        /* ========================
           üìä Cards Section
           ======================== */
        .cards {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
        }

        .card .value {
            font-size: 1.75rem;
            color: black;
            margin-top: 10px;
            font-weight: normal;
            white-space: nowrap;
        }

        .card.pink {
            background-color: #e91e63;
            flex: 0 0 auto;
            width: auto;
        }

        .card.light-pink {
            background-color: #f8bbd0;
        }

        .card.orange {
            background-color: #ff9800;
        }

        .card.deep-pastel-pink {
            background-color: #f06292;
        }

        /* ========================
           ‚úçÔ∏è Tables
           ======================== */
        table.dataTable {
            width: 100% !important;
            border-collapse: collapse;
            font-size: 0.85rem;
            color: black;
        }

        table.dataTable th,
        table.dataTable td {
            border: 1px solid #ccc;
            padding: 4px 6px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        table.dataTable thead th {
            background-color: #f06292;
            color: black;
            font-weight: bold;
        }

        /* START: CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FixedHeader */
        table.dataTable.fixedHeader-floating {
            background-color: white;
        }
        /* END: CSS */

        .src-note {
            display: block;
            font-size: 0.65rem;
            color: #555;
            margin-top: 3px;
        }

        /* ========================
           ‚öôÔ∏è Filters
           ======================== */
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            gap: 15px;
            padding: 15px;
            background-color: #f8bbd0;
            border-radius: 8px;
            margin-bottom: 10px;
            margin-top: 20px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 160px;
            flex-grow: 1;
        }

        .filter-item label {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #333;
        }

        .filter-item select {
            width: 100%;
            padding: 6px;
            box-sizing: border-box;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.85rem;
            height: 35px;
        }

        .reset-button-container {
            flex-grow: 1;
            min-width: 160px;
        }

        .reset-button-container button {
            width: 100%;
            padding: 6px 15px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            background-color: #d9534f;
            color: white;
            cursor: pointer;
            height: 35px;
            font-weight: bold;
        }

        .reset-button-container button:hover {
            background-color: #c9302c;
        }

        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter {
            margin-bottom: 15px;
        }

        .dataTables_wrapper .dataTables_info_custom {
            float: left;
            padding-top: 0.85em;
            white-space: nowrap;
        }

        /* ========================
           üö® Modal Styles
           ======================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease-in-out;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-content h3, .modal-content h4 {
            color: #e91e63;
            text-align: center;
        }

        .modal-content p, .modal-content li {
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-buttons .accept-button {
            background-color: #4caf50;
            color: white;
        }

        .modal-buttons .read-more-button {
            background-color: #2196f3;
            color: white;
        }

        .modal-buttons .close-button {
            background-color: #f44336;
            color: white;
        }

        .modal-buttons button:hover {
            filter: brightness(1.1);
        }

        .read-more-modal .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
        }

        .read-more-modal .close-button:hover {
            color: #555;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-text">
                <h1>
                    <span style="color: navy;">CD</span>
                    <span style="color: deeppink;">Women</span>
                    <span style="color: red;">POD</span>
                </h1>
                <h2>
                    <span style="color: black;">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    <span style="color: red;" id="province-title">‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span>
                </h2>
                <div style="color: navy; font-weight: bold; margin-top: 8px;">
                    <span style="font-size: 1.2rem;">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span><br />
                    <p align="right">
                        <span style="font-size: 2rem;" id="update-date">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 27 ‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° 2568 </span>
                    </p>
                </div>
            </div>
            <div class="logo-container">
                <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo" width="60" height="140" />
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Additional Logo" />
            </div>
        </div>

        <div class="cards">
            <div class="card pink">
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                <div class="value" id="num-projects">-</div>
            </div>
            <div class="card light-pink">
                ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2567 (A)
                <div class="value" id="debt-start">-</div>
                ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)
                <div class="value" id="debt-now">-</div>
            </div>
            <div class="card orange">
                ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)
                <div class="value" id="overdue">-</div>
                ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞
                <div class="value" id="percent-overdue">-</div>
            </div>
            <div class="card deep-pastel-pink">
                ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                <div class="value" id="approved-money">-</div>
            </div>
            <div class="card deep-pastel-pink">
                ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)
                <div class="value" id="legal">-</div>
            </div>
        </div>

        <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</h3>

        <div id="filter-container" class="filter-container"></div>
        <div id="table-info-wrapper" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div class="dataTables_info_custom" id="custom-info"></div>
            <div class="dataTables_length"></div>
        </div>

        <table id="districtDetails" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï</th>
                    <th>‡∏ï‡∏≥‡∏ö‡∏•</th>
                    <th>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</th>
                    <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                    <th>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                    <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                    <th>‡∏á‡∏ß‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</th>
                    <th>‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2567 (A) </th>
                    <th>‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å) </th>
                    <th>‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç) </th>
                    <th>‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)</th>
                    <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á(‡∏á1)</th>
                    <th>‡∏®‡∏≤‡∏•‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏ü‡πâ‡∏≠‡∏á(‡∏á2)</th>
                    <th>‡∏®‡∏≤‡∏•‡πÑ‡∏î‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ(‡∏á3)</th>
                    <th>‡∏®‡∏≤‡∏•‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏°(‡∏á4)</th>
                    <th>‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ(‡∏á5)</th>
                    <th>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤(‡∏á6)</th>
                    <th>‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)</th>
                    <th>‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="modal-overlay" id="mainModal">
        <div class="modal-content">
            <h3>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
            <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</p>
            <div class="modal-buttons">
                <button class="accept-button" id="acceptBtn">‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö</button>
                <button class="read-more-button" id="readMoreBtn">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="readMoreModal">
        <div class="modal-content read-more-modal">
            <button class="close-button" id="readMoreCloseBtn">&times;</button>
            <p><h3>‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3></p>
            <h3>‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®/‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
               
                    <h4> ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≤‡∏£‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ï‡πà‡∏≠ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>
              
                    <h4> ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h4>
                    <p>‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</p>
               
                    <h4> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <p>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠</p>
               
                    <h4> ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h4>
                    <p>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≠‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏î ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ</p>
               
                    <h4> ‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î</h4>
                    <p>‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÇ‡∏î‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
              
            <div class="modal-buttons">
                <button class="accept-button" id="readMoreAcceptBtn">‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
    <script>
        // ‚öôÔ∏è Constants & Global Variables
        const API_URL = "https://script.google.com/macros/s/AKfycbz6NJS7gAKNA8sgIp-FXN5opWM0owYPsFK9XzePtIGY7BH6EMnPkcqCQZxiGhRMClKe/exec";

        const KEY_MAP = {
            no: ["no", "‡∏•‡∏≥‡∏î‡∏±‡∏ö"],
            district: ["district", "‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï", "‡∏≠‡∏≥‡πÄ‡∏†‡∏≠", "‡πÄ‡∏Ç‡∏ï"],
            subdistrict: ["subdistrict", "‡∏ï‡∏≥‡∏ö‡∏•"],
            fiscalYear: ["fiscalYear", "‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì"],
            contractNo: ["contractNo", "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤"],
            projectName: ["projectName", "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"],
            proposer: ["proposer", "‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"],
            approvedMoney: ["approvedMoney", "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"],
            startDate: ["startDate", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤"],
            endDate: ["endDate", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤"],
            lastPaymentDate: ["lastPaymentDate", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î"],
            remainingInstallments: ["remainingInstallments", "‡∏á‡∏ß‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞"],
            debtStart: ["debtStart", "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2567 (A)"],
            debtNow: ["debtNow", "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)"],
            notDue: ["notDue", "‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)"],
            mediation: ["mediation", "‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)"],
            prosecutor: ["prosecutor", "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á(‡∏á1)"],
            courtFiled: ["courtFiled", "‡∏®‡∏≤‡∏•‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏ü‡πâ‡∏≠‡∏á(‡∏á2)"],
            judgment: ["judgment", "‡∏®‡∏≤‡∏•‡πÑ‡∏î‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ(‡∏á3)"],
            judgmentAgree: ["judgmentAgree", "‡∏®‡∏≤‡∏•‡∏°‡∏µ‡∏Ñ‡∏≥‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏°(‡∏á4)"],
            civil20tri: ["civil20tri", "‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ(‡∏á5)"],
            criminalCase: ["criminalCase", "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ç‡∏≤(‡∏á6)"],
            legalAction: ["legalAction", "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)"],
            overdue: ["overdue", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)"],
            percentOverdue: ["percentOverdue", "‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞"],
            paymentStatus: ["paymentStatus", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ"],
            projectStatus: ["projectStatus", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"],
            note: ["note", "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"]
        };

        // üî¢ Helper Functions
        function findValue(rowObj, logicalKey) {
            const candidates = KEY_MAP[logicalKey] || [logicalKey];
            for (const k of candidates) {
                if (Object.prototype.hasOwnProperty.call(rowObj, k) && rowObj[k] !== null && rowObj[k] !== "") {
                    return rowObj[k];
                }
            }
            if (Object.prototype.hasOwnProperty.call(rowObj, logicalKey) && rowObj[logicalKey] !== null && rowObj[logicalKey] !== "") {
                return rowObj[logicalKey];
            }
            return null;
        }

        function safeNumberFormat(val) {
            if (val === null || val === undefined || val === "") return "-";
            const s = String(val).replace(/,/g, "").trim();
            if (s === "" || isNaN(Number(s))) return "-";
            return Number(s).toLocaleString("th-TH", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function safePercentFormat(val) {
            if (val === null || val === undefined || val === "") return "-";
            const s = String(val).replace(/,/g, "").trim();
            if (s === "" || isNaN(Number(s))) return "-";
            return Number(s).toFixed(2) + "%";
        }

        function formatDateThai(dateStr) {
            if (!dateStr && dateStr !== 0) return "-";
            const s = String(dateStr).trim();
            const parts = s.split("/");
            if (parts.length === 3) {
                const d = Number(parts[0]),
                    m = Number(parts[1]) - 1,
                    y = Number(parts[2]);
                if (!isNaN(d) && !isNaN(m) && !isNaN(y)) {
                    const dt = new Date(y, m, d);
                    if (!isNaN(dt)) return dt.toLocaleDateString("th-TH");
                }
            }
            const dd = new Date(s);
            if (!isNaN(dd)) return dd.toLocaleDateString("th-TH");
            return s || "-";
        }

        // üíæ Data & Table Variables
        let allData = [];
        let dataTable;

        // üì• Main Data Fetch Function
        async function loadData() {
            const params = new URLSearchParams(window.location.search);
            const province = params.get("province") || "";
            if (!province) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ province ‡πÉ‡∏ô URL ‡πÄ‡∏ä‡πà‡∏ô ?province=‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£");
                return;
            }
            document.getElementById("province-title").textContent = province;

            try {
                const res = await fetch(`${API_URL}?province=${encodeURIComponent(province)}`);
                const json = await res.json();
                if (json.error) {
                    throw new Error(json.error);
                }

                // Update summary cards
                if (json.summary) {
                    const s = json.summary;
                    document.getElementById("num-projects").textContent = s.totalProjects !== null ? s.totalProjects : "-";
                    document.getElementById("approved-money").textContent = safeNumberFormat(s.approvedMoney);
                    document.getElementById("debt-start").textContent = safeNumberFormat(s.debtStart);
                    document.getElementById("debt-now").textContent = safeNumberFormat(s.debtNow);
                    document.getElementById("overdue").textContent = safeNumberFormat(s.overdue);
                    document.getElementById("percent-overdue").textContent = safePercentFormat(s.percentOverdue);
                    document.getElementById("legal").textContent = safeNumberFormat(s.legal);
                    if (s.updateDate) document.getElementById("update-date").textContent = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà " + s.updateDate;
                }

                allData = json.data || [];
                populateTable(allData);

            } catch (err) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: " + (err.message || err));
                console.error(err);
            }
        }

        // ‚û°Ô∏è Populate & Initialize DataTable
        function populateTable(data) {
            if ($.fn.dataTable.isDataTable("#districtDetails")) {
                $("#districtDetails").DataTable().destroy();
            }

            const tbody = document.querySelector("#districtDetails tbody");
            tbody.innerHTML = "";
            data.forEach((row, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${findValue(row, "no") ?? (index + 1)}</td>
                    <td>${findValue(row, "district") ?? "-"}</td>
                    <td>${findValue(row, "subdistrict") ?? "-"}</td>
                    <td>${findValue(row, "fiscalYear") ?? "-"}</td>
                    <td>${findValue(row, "contractNo") ?? "-"}</td>
                    <td>${findValue(row, "projectName") ?? "-"}</td>
                    <td>${findValue(row, "proposer") ?? "-"}</td>
                    <td>${safeNumberFormat(findValue(row, "approvedMoney"))}</td>
                    <td>${formatDateThai(findValue(row, "startDate"))}</td>
                    <td>${formatDateThai(findValue(row, "endDate"))}</td>
                    <td>${formatDateThai(findValue(row, "lastPaymentDate"))}</td>
                    <td>${findValue(row, "remainingInstallments") ?? "-"}</td>
                    <td>${safeNumberFormat(findValue(row, "debtStart"))}</td>
                    <td>${safeNumberFormat(findValue(row, "debtNow"))}</td>
                    <td>${safeNumberFormat(findValue(row, "notDue"))}</td>
                    <td>${safeNumberFormat(findValue(row, "mediation"))}</td>
                    <td>${safeNumberFormat(findValue(row, "prosecutor"))}</td>
                    <td>${safeNumberFormat(findValue(row, "courtFiled"))}</td>
                    <td>${safeNumberFormat(findValue(row, "judgment"))}</td>
                    <td>${safeNumberFormat(findValue(row, "judgmentAgree"))}</td>
                    <td>${safeNumberFormat(findValue(row, "civil20tri"))}</td>
                    <td>${safeNumberFormat(findValue(row, "criminalCase"))}</td>
                    <td>${safeNumberFormat(findValue(row, "legalAction"))}</td>
                    <td>${safeNumberFormat(findValue(row, "overdue"))}</td>
                    <td>${safePercentFormat(findValue(row, "percentOverdue"))}</td>
                    <td>${findValue(row, "paymentStatus") ?? "-"}</td>
                    <td>${findValue(row, "projectStatus") ?? "-"}</td>
                    <td>${findValue(row, "note") ?? "-"}</td>
                `;
                tbody.appendChild(tr);
            });

            dataTable = $("#districtDetails").DataTable({
                fixedHeader: true,
                scrollX: true,
                pageLength: 100,
                dom: '<"top"lf<"dataTables_info_custom">r>tip',
                language: {
                    search: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á:",
                    lengthMenu: "‡πÅ‡∏™‡∏î‡∏á _MENU_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
                    info: "‡πÅ‡∏™‡∏î‡∏á _START_ ‡∏ñ‡∏∂‡∏á _END_ ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î _TOTAL_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
                    infoEmpty: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                    zeroRecords: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô",
                    paginate: {
                        first: "‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
                        last: "‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢",
                        next: "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
                        previous: "‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤"
                    }
                },
                initComplete: function() {
                    $('#table-info-wrapper .dataTables_length').append(
                        $('.dataTables_wrapper .dataTables_length')
                    );
                    $('#table-info-wrapper .dataTables_info_custom').text(`‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.api().rows().count()} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
            });

            dataTable.on('draw.dt', function() {
                const info = dataTable.page.info();
                $('#custom-info').text(`‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${info.recordsDisplay} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            });

            setupCustomFilters(dataTable, allData);
        }

        // üîç Setup Custom Filters
        function setupCustomFilters(table, data) {
            const filterContainer = $('#filter-container');
            filterContainer.empty();

            const dropdownColumns = {
                1: 'district',
                2: 'subdistrict',
                3: 'fiscalYear',
                25: 'paymentStatus',
                26: 'projectStatus',
                27: 'note'
            };

            Object.entries(dropdownColumns).forEach(([index, key]) => {
                const column = table.column(parseInt(index));
                const title = $(column.header()).text();

                const filterItem = $('<div class="filter-item"></div>');
                const label = $('<label>' + title + '</label>');
                const select = $(`<select id="filter-${key}"><option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option></select>`);

                filterItem.append(label).append(select);
                filterContainer.append(filterItem);

                const options = [...new Set(data.map(item => findValue(item, key)).filter(Boolean))].sort();
                options.forEach(opt => {
                    select.append(`<option value="${$('<div/>').text(opt).html()}">${$('<div/>').text(opt).html()}</option>`);
                });
            });

            const resetButtonContainer = $('<div class="reset-button-container"></div>');
            const resetButton = $('<button>‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>');
            resetButtonContainer.append(resetButton);
            filterContainer.append(resetButtonContainer);

            function applyFilters() {
                const selectedDistrict = $('#filter-district').val();
                const subdistrictSelect = $('#filter-subdistrict');
                const currentSubdistrict = subdistrictSelect.val();
                subdistrictSelect.html('<option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>');

                if (selectedDistrict) {
                    const subdistricts = [...new Set(
                        data
                        .filter(item => findValue(item, 'district') === selectedDistrict)
                        .map(item => findValue(item, 'subdistrict')).filter(Boolean)
                    )].sort();
                    subdistricts.forEach(opt => {
                        subdistrictSelect.append(`<option value="${$('<div/>').text(opt).html()}">${$('<div/>').text(opt).html()}</option>`);
                    });
                    if (subdistricts.includes(currentSubdistrict)) {
                        subdistrictSelect.val(currentSubdistrict);
                    }
                } else {
                    const allSubdistricts = [...new Set(data.map(item => findValue(item, 'subdistrict')).filter(Boolean))].sort();
                    allSubdistricts.forEach(opt => {
                        subdistrictSelect.append(`<option value="${$('<div/>').text(opt).html()}">${$('<div/>').text(opt).html()}</option>`);
                    });
                }

                Object.entries(dropdownColumns).forEach(([index, key]) => {
                    const column = table.column(parseInt(index));
                    const val = $(`#filter-${key}`).val();
                    column.search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false);
                });
                table.draw();
            }

            filterContainer.on('change', 'select', applyFilters);

            resetButton.on('click', function() {
                filterContainer.find('select').val('');
                table.search('').draw();
                applyFilters();
            });
        }

        // üöÄ Initial Call & Modal Logic
        $(document).ready(function() {
            const mainModal = $('#mainModal');
            const readMoreModal = $('#readMoreModal');
            const acceptBtn = $('#acceptBtn');
            const readMoreBtn = $('#readMoreBtn');
            const readMoreAcceptBtn = $('#readMoreAcceptBtn');
            const readMoreCloseBtn = $('#readMoreCloseBtn');

            function showMainModal() {
                mainModal.css('display', 'flex');
                $('body').css('overflow', 'hidden'); // Prevent scrolling
            }

            function showReadMoreModal() {
                mainModal.hide();
                readMoreModal.css('display', 'flex');
                $('body').css('overflow', 'hidden');
            }

            function closeAllModals() {
                mainModal.hide();
                readMoreModal.hide();
                $('body').css('overflow', 'auto'); // Restore scrolling
                loadData(); // Load dashboard data after user accepts terms
            }

            acceptBtn.on('click', closeAllModals);
            readMoreBtn.on('click', showReadMoreModal);
            readMoreAcceptBtn.on('click', closeAllModals);
            readMoreCloseBtn.on('click', closeAllModals);

            // Show the initial pop-up when the page loads
            showMainModal();
        });
    </script>
</body>
</html>






