<!DOCTYPE html>

<html lang="th">

<head>
 
  
  
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">


  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CDDWomenfund Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />
  

  <!-- FixedColumns CSS -->
<link rel="stylesheet"
      href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css">

<!-- FixedColumns JS -->
<script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>

 
  
  <style>
    body {

      font-family: 'Sarabun', sans-serif;
      margin: 0;
      background: linear-gradient(to bottom right, #ffe6f0, #f3e5f5, #e1bee7);
      background-attachment: fixed;
      color: #000;
    }

    .dashboard-container {
      padding: 40px;
      background-color: rgba(255, 255, 255, 0.9);
      min-height: 100vh;
    }

    .scale-control {
      font-size: 1rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .header-text h1 {
      margin: 0;
      font-size: 2.5rem;
    }

    .header-text h2 {
      margin: 0;
      font-size: 1.5rem;
    }

    .logo-container img {
      height: 60px;
      margin-left: 10px;
    }

    /* Cards */
    .cards {
      display: flex;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1;
      min-width: 250px;
      padding: 20px;
      border-radius: 12px;
      color: white;
      font-weight: bold;
    }

    .card .value {
      font-size: 1.75rem;
      color: black;
      margin-top: 10px;
      font-weight: normal;
      white-space: nowrap;
    }

    .card.pink {
      background-color: #e91e63;
      flex: 0 0 auto;
      width: auto;
    }

    .card.light-pink {
      background-color: #FB6F92;
    }

    .card.orange {
      background-color: #ff9800;
    }

    .card.pastel-pink {
      background-color: #FF3333;
    }

    .card.deep-pastel-pink {
      background-color: #f06292;
    }

    .main-visuals {
      display: flex;
      margin-top: 30px;
      gap: 20px;
      flex-wrap: wrap;
      align-items: flex-start;
    }

    .left,
    .center,
    .right {
      flex: 1;
      min-width: 300px;
    }

    .center {
      text-align: center;
    }

    canvas {
      max-width: 100%;
    }

    #donutChart {
      height: 500px !important;
    }

    .section-title {
      text-align: center;
      font-weight: bold;
      margin: 10px 0;
      font-size: 1.2rem;
    }

    .center img {
      width: 250px;
      display: block;
      margin: 0 auto 10px;
    }


    /* ‚úÖ Toolbar */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .left-tools {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .left-tools button {
      background-color: #f8bbd0;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      color: #880e4f;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: 0.2s;
    }

    .left-tools button:hover {
      background-color: #f48fb1;
    }

    .left-tools img {
      height: 18px;
    }

    .filter-bar {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-bar select,
    .filter-bar input {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #f48fb1;
      font-family: 'Sarabun';
      font-size: 0.9rem;
      transition: border 0.3s ease;
    }

    /* Table */

    .province-table-wrapper {
      margin-top: 40px;
      margin-left: 0; 
      text-align: left !important;
      overflow-x: auto;
      overflow-y: auto;
      /* ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
      padding-bottom: 10px;
    }

    .summary-table {
      width: 100%;
      /* ‚úÖ ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° container ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ DataTable sync header ‡πÑ‡∏î‡πâ */
      border-collapse: collapse;
      table-layout: auto;
      /* ‚úÖ ‡πÉ‡∏ä‡πâ auto ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ header/body align ‡∏ï‡∏£‡∏á */
      font-size: 0.9rem;
      color: black;
    }

    .summary-table th {
      background-color: #f06292;
      color: black;
      padding: 10px 12px;
      border: 1px solid #f8bbd0;
      font-weight: bold;
      text-align: center;
      vertical-align: middle;
      white-space: normal;
      word-wrap: break-word;
      line-height: 1.4;
      min-width: 130px;
      /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ */
    }

    .summary-table td {
      padding: 8px 10px;
      border: 1px solid #f8bbd0;
      color: black;
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 130px;
    }



    .summary-table tr:nth-child(even) {
      background-color: #fce4ec;
    }

    .summary-table tr:nth-child(odd) {
      background-color: white;
    }

    .province-link {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
    }

    .province-link:hover {
      color: darkblue;
    }

    #studyCenterTable tbody tr {
      cursor: pointer;
    }

    #studyCenterTable tbody tr:hover {
      background-color: #e0e0e0 !important;
    }

    #studyCenterTable tbody tr.selected-row {
      background-color: #d1e7fd !important;
      font-weight: bold;
    }

    .clickable-header {
      cursor: pointer;
    }

    .clickable-header:hover {
      color: #555;
    }

    .center-name-link {
      color: blue;
      text-decoration: underline;
    }

    .align-left {
      text-align: left !important;
    }

    .align-center {
      text-align: center !important;
    }

    .align-right {
      text-align: right !important;
    }

    #log {
      color: navy;
      font-weight: bold;
      margin-top: 15px;
      text-align: center;
      font-size: 1.1rem;
    }

    @media (max-width: 1024px) {
      .header-text h1 {
        font-size: 2rem;
      }

      .header-text h2 {
        font-size: 1.2rem;
      }

      .cards {
        flex-direction: column;
      }

      .province-table-wrapper {
        margin-left: 0;
        overflow-x: auto;
      }

      .summary-table th,
      .summary-table td {
        padding: 4px;
        font-size: 0.75rem;
        height: 60px;
      }

    }

.dataTables_wrapper .DTFC_LeftWrapper table {
  background-color: #fce4ec;
}
.DTFC_LeftWrapper {
  border-right: 2px solid #f06292;
}


   
    .dataTables_scrollHeadInner {
      width: 100% !important;
    }

    /* ‚úÖ Fix ‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á */
    .dataTables_scrollHeadInner,
    .dataTables_scrollHeadInner table {
      width: 100% !important;
    }

    .dataTables_scrollBody table {
      width: 100% !important;
    }

    table.dataTable {
      border-collapse: collapse !important;
      /* ‚úÖ ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô */
    }

    /* ===== iframe mode (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö standalone) ===== */
    body.iframe-mode {
      background: transparent;
    }

    body.iframe-mode .header,
    body.iframe-mode .toolbar,
    body.iframe-mode .data-date {
      display: none !important;
    }

    body.iframe-mode .dashboard-container {
      padding: 12px 6px;
      min-height: auto;
      background: transparent;
    }

   #studyCenterTable {
  width: 100%;
  border-collapse: collapse;
}

#studyCenterTable th,
#studyCenterTable td {
  padding: 6px;
  border: 1px solid #f8bbd0;
  white-space: normal;
}
   
#provinceTable {
  table-layout: fixed !important;
}

/* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: table ‡∏à‡∏£‡∏¥‡∏á + fixed + cloned */
#provinceTable th:first-child,
#provinceTable td:first-child,
.DTFC_LeftWrapper th,
.DTFC_LeftWrapper td,
.DTFC_Cloned th,
.DTFC_Cloned td {
  width: 180px !important;
  min-width: 180px !important;
  max-width: 180px !important;
  white-space: nowrap;
}



   
  </style>
  <script>
    const IS_IFRAME = window.self !== window.top;
  </script>
</head>

<body>

  <div class="dashboard-container scale-control">
    <div class="header">
      <div class="header-text">
        <h1><span style="color: navy;">CDD</span><span style="color: deeppink;">Women</span><span
            style="color: red;">Fund</span></h1>
        <h2><span style="color: black;">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• </span><span style="color: deeppink;">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® </span><span
            style="color: red;" id="province-title">‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span></h2>
        <div style="color: navy; font-weight: bold; font-size: 1.5rem; margin-top: 1rem;">
          ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
        </div>

      </div>

      <div class="logo-container">
        <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo" width="60" height="140" />
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s"
          alt="Additional Logo" />
      </div>

    </div>

    <div class="data-date"
      style="color: navy; font-weight: bold; text-align: right; font-size: 1.5rem; margin-top: 1rem;">
      ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 20 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568

    </div>

    <!-- ‚úÖ Toolbar -->
    <div class="toolbar">
      <div class="left-tools">
        <button onclick="window.location.href='Menu.html'">
          <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="home"> ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
        </button>
      </div>
    </div>

    <div id="log">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...</div>

    <!-- üü£ Cards -->
    <div class="cards">
      <div class="card pink">
        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£<div class="value" id="num-projects">-</div>
        ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥<div class="value" id="approved-money-card1">-</div>
        ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2568<div class="value" id="debt-start-card1">-</div>

      </div>

      <div class="card light-pink">
        ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)<div class="value" id="debt-now-card2">-</div>
        ‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)<div class="value" id="not-due-card2">-</div>

      </div>

      <div class="card orange">
        ‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)<div class="value" id="mediation">-</div>
        ‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ(‡∏á5)<div class="value" id="civil-law-20">-</div>

      </div>

      <div class="card pastel-pink">

        ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)<div class="value" id="legal-card4">-</div>
        ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ<div class="value" id="principal-legal">-</div>
        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£<div class="value" id="overdue-legal">-</div>

      </div>

      <div class="card deep-pastel-pink">
        ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)<div class="value" id="overdue-card5">-</div>
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞<div class="value" id="percent-overdue-card5">-</div>


      </div>

    </div>

    <div class="main-visuals">
      <div class="left">
        <div class="section-title">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
        <canvas id="donutChart"></canvas>
      </div>

      <div class="center">
        <img src="https://i.postimg.cc/hPqX5RFW/twdf.png" alt="‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á" style="width: 400px; height: auto;" />
      </div>

      <div class="card deep-pastel-pink" style="min-width:320px;">
        <div style="font-weight: bold; color: white;">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</div>
        <br />
        <div style="max-width:100%; overflow:auto;">
          <table class="summary-table" id="studyCenterTable" style="color: black; width: 100%;">
            <thead>
              <tr>
                <th class="clickable-header" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</th>
                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>

    <div class="province-table-wrapper">
      <table class="summary-table" id="provinceTable" style="width:100%;">
        <thead>
          <!-- will be replaced dynamically by JS -->

        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <script>
    function resizeIframe() {
      if (!IS_IFRAME) return;
      window.parent.postMessage(
        { type: "resize-iframe", height: document.body.scrollHeight },
        "*"
      );
    }

    window.addEventListener("load", () => setTimeout(resizeIframe, 500));
    window.addEventListener("resize", resizeIframe);
  </script>

  <script>
    if (IS_IFRAME) {
      document.body.classList.add("iframe-mode");
    }
  </script>

  <script>


    const API_URL = "https://script.google.com/macros/s/AKfycby-WMXu4yHrGqdETd37jqoYVpQK3lktS2lY-UMaze1Dz29jp1vUBNqeQz5DQmfBYddM/exec";
    let donutChartInstance = null;
    let provinceDataTable = null;

    /* === Mapping ‡∏Ñ‡∏µ‡∏¢‡πå ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ === */

    const columnMap = {
      province: "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î",
      totalProjects: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
      approvedAmount: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
      debtStart: "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 1 ‡∏ï.‡∏Ñ. 2568",
      debtNow: "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å)",
      notDue: "‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (‡∏Ç)",
   
      recoveredInterest: "‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢",
      recoveredFine: "‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏±‡∏ö",
      recoveredPenaltyInterest: "‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏¥‡∏î‡∏ô‡∏±‡∏î",
      recoveredOverpay: "‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô",
      recoveredTotal: "‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ß‡∏°",
      debtAsOf30968: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì 30 ‡∏Å.‡∏¢. 2568",
      mediation: "‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏î‡∏µ‡πÑ‡∏î‡πâ (‡∏Ñ)",
     
      civilLaw20: "‡∏õ.‡∏ß‡∏¥ ‡πÅ‡∏û‡πà‡∏á ‡∏°.20 ‡∏ï‡∏£‡∏µ (‡∏á5)",
   
      legalAction: "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏á)",
      principalLegal: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏î‡∏µ",
      overdueLegal: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£",
      overdue: "‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (B)",
      overduePercent: "‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞ (C)",
      
      statusPayment: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ",
      projectStatus: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
      notes: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏",
      debtRestructure: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ",
      mediationAct2562: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏û‡∏≤‡∏ó ‡∏û.‡∏®. 2562",
      civilBeforeCourt: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏ü‡πâ‡∏≠‡∏á ‡∏ï‡∏≤‡∏° ‡∏õ.‡∏ß‡∏¥.‡∏û. ‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 ‡∏ï‡∏£‡∏µ",
      defaultSettlement: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡πÑ‡∏Å‡∏•‡πà‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ô‡∏µ‡∏õ‡∏£‡∏∞‡∏ô‡∏≠‡∏°‡∏≠‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏ì‡∏µ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ú‡∏¥‡∏î‡∏ô‡∏±‡∏î",
      reducePenalty: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏á‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏±‡∏ö/‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏¥‡∏î‡∏ô‡∏±‡∏î",
      reduceInterest2566: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏¥‡∏î‡∏ô‡∏±‡∏î ‡∏û.‡∏®. 2566"

    };


    /* === ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ === */
    const orderedColumns = [

      "province", "totalProjects", "approvedAmount",
      "debtStart", "debtNow", "notDue", 
      "recoveredInterest", "recoveredFine", "recoveredPenaltyInterest", "recoveredOverpay", "recoveredTotal", "debtAsOf30968",
      "mediation",  "civilLaw20", 
      "legalAction", "principalLegal", "overdueLegal", "overdue", "overduePercent",
      "statusPayment", "projectStatus",
      "debtRestructure",
      "mediationAct2562",
      "civilBeforeCourt",
      "defaultSettlement",
      "reducePenalty",
      "reduceInterest2566",
      "notes",


    ];

    /* === ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô format ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå === */

    function formatNumber(num) {
      if (num === null || num === undefined || String(num).trim() === "") return "-";
      const n = Number(String(num).replace(/[^0-9.-]/g, ''));
      if (!isFinite(n)) return String(num);
      return n.toLocaleString("th-TH");

    }

    function formatPercent(val) {
      const num = parseFloat(String(val).replace(/[^0-9.-]/g, ''));
      return isNaN(num) ? "-" : num.toFixed(2) + "%";

    }

    /* === ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å === */
    async function fetchData() {
      const logEl = document.getElementById("log");
      logEl.textContent = "üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...";
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        if (data.error) { console.error("Apps Script Error:", data.error); logEl.textContent = "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"; return; }
        const overview = data.overview || {};
        const pieChartData = data.topOverdue || [];
        const provinces = data.provinces || [];

        /* === Update Cards === */
        document.getElementById('num-projects').textContent = formatNumber(overview.B2);
        document.getElementById('approved-money-card1').textContent = formatNumber(overview.C2);
        document.getElementById('debt-start-card1').textContent = formatNumber(overview.D2);
        document.getElementById('debt-now-card2').textContent = formatNumber(overview.E2);
       
        document.getElementById('not-due-card2').textContent = formatNumber(overview.F2);
        document.getElementById('mediation').textContent = formatNumber(overview.H2);
       
        document.getElementById('civil-law-20').textContent = formatNumber(overview.M2);
     
        document.getElementById('legal-card4').textContent = formatNumber(overview.O2);
        document.getElementById('principal-legal').textContent = formatNumber(overview.P2);
        document.getElementById('overdue-legal').textContent = formatNumber(overview.Q2);
        document.getElementById('overdue-card5').textContent = formatNumber(overview.R2);
        document.getElementById('percent-overdue-card5').textContent = formatPercent(overview.S2);
        
    

        /* === Donut Chart === */
        if (donutChartInstance) donutChartInstance.destroy();
        const ctx = document.getElementById('donutChart').getContext('2d');
        donutChartInstance = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: pieChartData.map(p => p.province),
            datasets: [{
              data: pieChartData.map(p => parseFloat(p.percent) || 0),
              backgroundColor: ['#FF202B', '#87FEBC', '#FFB6B7', '#FFDD63', '#F68B71', '#DAB9E6', '#A0E8E8', '#ADFF2F', '#FFFF00', '#FFA500']
            }]

          },

          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              tooltip: { callbacks: { label: c => `${c.label}: ${parseFloat(c.raw).toFixed(2)}%` } }
            }

          }

        });


        /* === ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á === */
        const table = document.querySelector("#provinceTable");
        const thead = table.querySelector("thead");
        const tbody = table.querySelector("tbody");
        tbody.innerHTML = "";

        if (!provinces || provinces.length === 0) {
          thead.innerHTML = "<tr><th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th><th>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th></tr>";
          logEl.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î";
          return;

        }

        const responseKeys = Object.keys(provinces[0]);
        const orderedPresent = orderedColumns.filter(k => responseKeys.includes(k));
        const remaining = responseKeys.filter(k => !orderedPresent.includes(k));
        const finalColumns = [...orderedPresent, ...remaining];
        const headerHtml = finalColumns.map(k => {
          const label = columnMap[k] || k;
          return `<th>${label}</th>`;

        }).join("");

        thead.innerHTML = `<tr>${headerHtml}</tr>`;
        provinces.forEach(p => {
          // const url = `https://tnah097.github.io/cdwomenpod-dashboard/Login.html?province=${encodeURIComponent(p.province)}`;
          const rowHTML = finalColumns.map(k => {
            const raw = p[k];
            if (k === "province") {
              const display = (raw === null || raw === undefined || raw === "") ? "-" : raw;
              const url = `https://tnah097.github.io/cdwomenpod-dashboard/Login.html?province=${encodeURIComponent(p.province)}`;

              return `
                <td class="align-left">
                  <a
                  href="${url}"
                    class="province-link"
                    target="_top">
                  ${display}
                  </a>
                </td>
              `;
            }

            if (k === "overduePercent" || String(k).toLowerCase().includes("percent")) {
              return `<td class="align-right">${formatPercent(raw)}</td>`;
            }
            if (raw === null || raw === undefined || raw === "") return `<td class="align-right">-</td>`;
            const numericCandidate = Number(String(raw).replace(/[^0-9.-]/g, ''));
            if (isFinite(numericCandidate)) {
              return `<td class="align-right">${formatNumber(numericCandidate)}</td>`;
            } else {
              return `<td class="align-right">${String(raw)}</td>`;
            }

          }).join("");

          tbody.innerHTML += `<tr>${rowHTML}</tr>`;
        });

        if ($.fn.DataTable.isDataTable('#provinceTable')) $('#provinceTable').DataTable().clear().destroy();

    provinceDataTable = $('#provinceTable').DataTable({
  paging: true,
  pageLength: 10,
  scrollX: true,
  scrollY: "420px",
  scrollCollapse: true,
  autoWidth: false,
  ordering: true,
  fixedHeader: true,

  /* ‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î */
  fixedColumns: {
    leftColumns: 1   // ‚Üê ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å (‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)
  },

  language: {
    search: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:",
    lengthMenu: "‡πÅ‡∏™‡∏î‡∏á _MENU_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
  }
});

        setTimeout(() => { if (provinceDataTable && provinceDataTable.columns) provinceDataTable.columns.adjust().draw(false); }, 200);
        logEl.textContent = "‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";

      } catch (e) { console.error(e); document.getElementById("log").textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; }

    }

    async function fetchStudyCenterData() {
      try {
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API (‡∏à‡∏∞‡πÉ‡∏ä‡πâ API_URL ‡πÄ‡∏î‡∏¥‡∏°) ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á action=studyCenter
        const res = await fetch(`${API_URL}?action=studyCenter`);
        const data = await res.json();
        if (data.error) {
          console.error("Apps Script Error (studyCenter):", data.error);
          return;
        }

        const centers = data.studyCenter || [];
        const tbody = document.querySelector("#studyCenterTable tbody");
        tbody.innerHTML = "";

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß
        centers.forEach(row => {
          const tr = document.createElement("tr");
          // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏ô attribute ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô DataTables ‡πÑ‡∏î‡πâ (pipe separated)
          const provinceList = (row.province || "").split(',').map(p => p.trim()).filter(Boolean).join('|');
          tr.setAttribute('data-provinces', provinceList);
          tr.innerHTML = `
        <td class="align-left"><span class="center-name-link">${row.name || "-"}</span></td>
        <td class="align-center">${Number(row.index || 0).toLocaleString("th-TH")}</td>
        <td class="align-left">${row.province || "-"}</td>
      `;
          tbody.appendChild(tr);
        });

        if ($.fn.DataTable.isDataTable('#studyCenterTable')) {
  $('#studyCenterTable').DataTable().clear().destroy();
}

$('#studyCenterTable').DataTable({
  paging: false,
  scrollY: '300px',
  scrollCollapse: true,
  searching: true,
  ordering: false,
  info: false,
  autoWidth: true
});

       
        // Event: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ñ‡∏ß‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏á provinceDataTable
        const $body = $('#studyCenterTable tbody');
        $body.off('click').on('click', 'tr', function () {
          if (!provinceDataTable) return; // ‡∏ñ‡πâ‡∏≤ province table ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà init
          const isSelected = $(this).hasClass('selected-row');
          $body.find('tr').removeClass('selected-row');
          if (!isSelected) {
            $(this).addClass('selected-row');
            const provinces = $(this).data('provinces') || "";
            // provinces ‡πÄ‡∏õ‡πá‡∏ô pipe-separated (a|b|c), ‡πÉ‡∏ä‡πâ regex match ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏≥
            const regex = `(${provinces})`;
            // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏ô provinceDataTable ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ column index 0 ‚Äî ‡πÉ‡∏ä‡πâ search ‡∏Å‡∏±‡∏ö regex
            provinceDataTable.column(0).search(regex, true, false).draw();
          } else {
            // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≥ ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á filter
            provinceDataTable.column(0).search('').draw();
          }
        });

        // clickable header (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ clear filter)
        $('.clickable-header').off('click').on('click', function () {
          if (!provinceDataTable) return;
          $body.find('tr').removeClass('selected-row');
          provinceDataTable.column(0).search('').draw();
        });

      } catch (err) {
        console.error("fetchStudyCenterData error:", err);
      }
    }





    fetchData(); fetchStudyCenterData();

    function goLogin(province) {
      sessionStorage.clear();
      window.top.location.href =
        `https://tnah097.github.io/cdwomenpod-dashboard/Login.html?province=${encodeURIComponent(province)}`;
    }



  </script>


</body>


</html>












