
        // เคลียร์ dropdown
        select.innerHTML = `<option value="">-- เลือกจังหวัด --</option>`;

        // ใส่จังหวัดทั้งหมดลง dropdown
        provinces.forEach(p => {
            const option = document.createElement("option");
            option.value = p;
            option.textContent = p;
            select.appendChild(option);
        });

    } catch (error) {
        console.error("โหลดจังหวัดล้มเหลว:", error);
        select.innerHTML = `<option value="">โหลดจังหวัดไม่สำเร็จ</option>`;
    }
}


// โหลดข้อมูลความต่างคอลัมน์ V ของจังหวัด
async function loadData() {
    const province = document.getElementById("provinceSelect").value;

    if (!province) {
        alert("กรุณาเลือกจังหวัดก่อนนะครับ");
        return;
    }

    const response = await fetch(`${API_URL}?province=${province}`);
    const data = await response.json();

    renderTable(data);
    renderChart(data);
}


// แสดงตารางผลลัพธ์
function renderTable(data) {
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td class="highlight">${row.contract}</td>
            <td>${row.kpi}</td>
            <td>${row.ny}</td>
            <td><b>${row.diff}</b></td>
        `;
        tbody.appendChild(tr);
    });
}


// แสดงกราฟแท่ง
function renderChart(data) {
    const ctx = document.getElementById("barChart");

    const labels = data.map(r => r.contract);
    const diffs = data.map(r => r.diff);

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "ผลต่างค่า V ต่อเลขที่สัญญา",
                data: diffs,
                backgroundColor: "#ff99c8",
                borderColor: "#e3548a",
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}
</script>

</body>
</html>
