<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ทะเบียนคุมการรับ-จ่ายเงินฝากคลัง (รหัส 10962)</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      background: url('https://www.dga.or.th/wp-content/uploads/2025/06/20250612_074641550_iOS-1120x746.jpg') center/cover no-repeat;
      background-attachment: fixed;
      color: #000;
    }
    .dashboard-container {
      padding: 40px;
      background-color: rgba(255, 255, 255, 0.95);
      margin: 20px;
      border-radius: 10px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .header-text h1 { margin: 0; font-size: 2rem; color: navy; }
    .header-text h2 { margin: 0; font-size: 1.3rem; color: deeppink; }
    .report-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
      margin-top: 0.5rem;
      font-size: 1rem;
      flex-wrap: wrap;
      gap: 20px;
    }
    .report-info .month,
    .report-info .year { color: red; }
    .logo-container img {
      height: 60px;
      margin-left: 10px;
    }
    .section-title {
      text-align: center;
      font-weight: bold;
      margin: 20px 0;
      font-size: 1.2rem;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      color: black;
    }
    .summary-table th, .summary-table td {
      padding: 4px 8px;
      border: 1px solid #ccc;
      text-align: center;
      font-weight: bold;
      white-space: nowrap;
    }
    .summary-table td { font-weight: normal; }
    .summary-table tbody tr:nth-child(even) { background-color: #fce4ec; }
    .summary-table tbody tr:nth-child(odd) { background-color: white; }
    
    /* Highlight the total row */
    .total-row {
      font-weight: bold;
      background-color: #fffacd !important; /* Lemon Chiffon color */
    }

    @media (max-width: 768px) {
      .dashboard-container { padding: 15px; margin: 10px; }
      .header { flex-direction: column; align-items: center; text-align: center; gap: 15px;}
      .logo-container img { height: 45px; }
      .header-text h1 { font-size: 1.5rem; }
      .summary-table { font-size: 0.7rem; }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="header">
      <div class="header-text">
        <h1>ทะเบียนคุมการรับ-จ่ายเงินฝากคลัง (รหัส 10962)</h1>
        <div class="report-info">
          <h2>รายงานประจำ <span class="month">ตุลาคม</span> พ.ศ. <span class="year">2567</span></h2>
          <h2 class="report-code">สกส.02/2568</h2>
        </div>
      </div>
      <div class="logo-container">
        <img src="https://cddadg.cdd.go.th/wp-content/uploads/sites/101/2017/06/CDD-NEW-LOGO3.png" alt="CDD Logo" />
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Additional Logo" />
      </div>
    </div>

    <div class="section-title">ตารางทะเบียนคุมการรับ-จ่ายเงินฝากคลัง</div>

    <div style="overflow-x:auto;">
      <table class="summary-table" id="mainTable">
        <thead>
          <tr>
            <th rowspan="2" style="background-color:#FF8FAB;">ลำดับ</th>
            <th rowspan="2" style="background-color:#FF8FAB;">จังหวัด</th>
            <th rowspan="2" style="background-color:#FF8FAB;">ยกมา</th>
            <th colspan="4" style="background-color:#76BC43;">รายรับ (รับโอนขายบิลจาก สกส.)</th>
            <th colspan="7" style="background-color:#76BC43;">เงินรับ (จากธนาคารรับชำระหนี้จาก อกส.จ.)</th>
            <th colspan="6" style="background-color:#76BC43;">รายการรับอื่น ๆ</th>
            <th colspan="10" style="background-color:#FF9967;">รายจ่าย โอนขายบิลให้ สกส.(ส่วนกลาง)</th>
            <th colspan="27" style="background-color:#FF9967;">รายการเบิกจ่ายของจังหวัด</th>
            <th rowspan="2" style="background-color:#C0E4F6;">ยอดเงินคงเหลือเงินฝากคลัง</th>
            <th rowspan="2" style="background-color:#FFCAC9;">หมายเหตุ (คีย์จำนวนเงินคงเหลือในGF)</th>
            <th rowspan="2" style="background-color:#F7D07A;">ผลต่างเงินฝากคลัง</th>
          </tr>
          <tr>
            <th style="background-color:#CCFFCC;">ทุนหมุนเวียน</th>
            <th style="background-color:#CCFFCC;">อุดหนุน</th>
            <th style="background-color:#CCFFCC;">บริหาร</th>
            <th style="background-color:#CCFFCC;">คืนเงินรับฝาก</th>
            <th style="background-color:#ADD88D;">เงินต้น</th>
            <th style="background-color:#ADD88D;">ดอกเบี้ยเงินกู้</th>
            <th style="background-color:#ADD88D;">ค่าปรับ</th>
            <th style="background-color:#ADD88D;">ดอกเบี้ยผิดนัด</th>
            <th style="background-color:#ADD88D;">เงินรอตรวจสอบ</th>
            <th style="background-color:#ADD88D;">ดอกเบี้ยเงินฝากธ.</th>
            <th style="background-color:#ADD88D;">เงินรับฝาก</th>
            <th style="background-color:#92CA68;">รับคืนทุนหมุนเวียน</th>
            <th style="background-color:#92CA68;">รับคืนเงินอุดหนุน</th>
            <th style="background-color:#92CA68;">คืนเงินงบบริหาร</th>
            <th style="background-color:#92CA68;">รายได้อื่น</th>
            <th style="background-color:#92CA68;">รับเงินผิดบัญชี</th>
            <th style="background-color:#92CA68;">รวมรายรับ</th>
            <th style="background-color:#FDDF8E;">เงินต้น</th>
            <th style="background-color:#FDDF8E;">ดอกเบี้ยเงินกู้</th>
            <th style="background-color:#FDDF8E;">ค่าปรับ</th>
            <th style="background-color:#FDDF8E;">ดอกเบี้ยผิดนัด</th>
            <th style="background-color:#FDDF8E;">เงินรอตรวจสอบ</th>
            <th style="background-color:#FDDF8E;">ดอกเบี้ยเงินฝากธ.</th>
            <th style="background-color:#FDDF8E;">เงินรับฝาก</th>
            <th style="background-color:#FDDF8E;">หมุนเวียน</th>
            <th style="background-color:#FDDF8E;">อุดหนุน</th>
            <th style="background-color:#FDDF8E;">บริหาร</th>
            <th style="background-color:#FCF695;">เงินอุดหนุน</th>
            <th style="background-color:#FCF695;">เงินทุนหมุนเวียน</th>
            <th style="background-color:#FCF695;">ลูกหนี้เงินยืม</th>
            <th style="background-color:#FCF695;">ฝึกอบรมในประเทศ</th>
            <th style="background-color:#FCF695;">ฝึกอบรมภายนอก</th>
            <th style="background-color:#FCF695;">ประชุมเบี้ยประชุม</th>
            <th style="background-color:#FCF695;">ค่าจัดประชุม</th>
            <th style="background-color:#FCF695;">เดินทาง-พาหนะ</th>
            <th style="background-color:#FCF695;">เดินทาง-เบี้ยเลี้ยง</th>
            <th style="background-color:#FCF695;">เดินทาง-ที่พัก</th>
            <th style="background-color:#FCF695;">ค่าวัสดุ</th>
            <th style="background-color:#FCF695;">ค่าไฟฟ้า</th>
            <th style="background-color:#FCF695;">ค่าโทรศัพท์</th>
            <th style="background-color:#FCF695;">ค่าอินเตอร์เน็ต</th>
            <th style="background-color:#FCF695;">ค่าไปรษณีย์</th>
            <th style="background-color:#FCF695;">ค่าน้ำ</th>
            <th style="background-color:#FCF695;">ค่าธรรมเนียมธ.</th>
            <th style="background-color:#FCF695;">คืนเงินชำระเกิน</th>
            <th style="background-color:#FCF695;">ค่าซ่อมบำรุง</th>
            <th style="background-color:#FCF695;">ครุภัณฑ์</th>
            <th style="background-color:#FCF695;">ค่าล่วงเวลา</th>
            <th style="background-color:#FCF695;">ค่าธรรมเนียมศาล</th>
            <th style="background-color:#FCF695;">ค่าจ้างเหมาบริการ</th>
            <th style="background-color:#FCF695;">ประชาสัมพันธ์</th>
            <th style="background-color:#FCF695;">ค่าใช้สอย</th>
            <th style="background-color:#FCF695;">ค่าใช้จ่ายอื่น</th>
            <th style="background-color:#FCF695;">รวมรายจ่าย</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
  // **ใช้ Apps Script URL เดิมที่ส่งข้อมูลกลับมาเป็น JSON**
  const API_URL = "https://script.google.com/macros/s/AKfycbxKba4uG2nhNlWzQh7I-OL1uT16UHboBS6wapcppxyWrnR7a1a29aQ2IPoJ1Gqeh8TA/exec";

  // Function to format numbers with commas for Thai locale
  function formatNumber(value) {
    const num = Number(value);
    if (isNaN(num)) return value; // Return original value if it's not a number
    return num.toLocaleString("th-TH", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
    });
  }
  
  // Function to create a table cell (<td>)
  function createCell(content, align = 'left', isNumber = false) {
      const cell = document.createElement("td");
      cell.textContent = isNumber ? formatNumber(content) : content;
      cell.style.textAlign = align;
      if (isNumber) {
          cell.style.textAlign = 'right'; // Force numbers to be right-aligned
      }
      return cell;
  }

  async function fetchData() {
    try {
      const res = await fetch(API_URL);
      if (!res.ok) throw new Error(`Network response was not ok: ${res.statusText}`);
      const data = await res.json();
      if (data.error) throw new Error(`API Error: ${data.error}`);

      const tbody = document.querySelector("#mainTable tbody");
      tbody.innerHTML = ""; // Clear existing content

      // Loop through all rows from the data
      data.rows.forEach((row, index) => {
        const tr = document.createElement("tr");

        // *** นี่คือส่วนที่แก้ไขตามที่คุณต้องการ ***
        // Check if it's the last row ("รวมระหว่างเดือน")
        if (index === data.rows.length - 1) {
            tr.className = "total-row"; // Add class for special styling
            const mergedCell = document.createElement("td");
            mergedCell.textContent = row.province.value; // Get text from data
            mergedCell.colSpan = 2; // Merge columns A and B
            mergedCell.style.textAlign = 'center'; // Center the text
            tr.appendChild(mergedCell);
            
            // Add remaining cells from C onwards
            tr.appendChild(createCell(row.start.value, row.start.align, true));
            tr.appendChild(createCell(row.fund.value, row.fund.align, true));
            //... add all other cells
        } else {
            // This is a normal province row
            tr.appendChild(createCell(index + 1, 'center')); // Column A: No.
            tr.appendChild(createCell(row.province.value, row.province.align)); // Column B: Province
            tr.appendChild(createCell(row.start.value, row.start.align, true));
            tr.appendChild(createCell(row.fund.value, row.fund.align, true));
            //... add all other cells
        }
        
        // This part is intentionally shortened for clarity
        // The pattern is the same for both if/else blocks from 'subsidy' onwards
        tr.appendChild(createCell(row.subsidy.value, row.subsidy.align, true));
        tr.appendChild(createCell(row.admin.value, row.admin.align, true));
        tr.appendChild(createCell(row.returnDeposit.value, row.returnDeposit.align, true));
        tr.appendChild(createCell(row.principal.value, row.principal.align, true));
        tr.appendChild(createCell(row.interest.value, row.interest.align, true));
        tr.appendChild(createCell(row.penalty.value, row.penalty.align, true));
        tr.appendChild(createCell(row.overdueInterest.value, row.overdueInterest.align, true));
        tr.appendChild(createCell(row.pending.value, row.pending.align, true));
        tr.appendChild(createCell(row.bankInterest.value, row.bankInterest.align, true));
        tr.appendChild(createCell(row.extraDeposit.value, row.extraDeposit.align, true));
        tr.appendChild(createCell(row.returnFund.value, row.returnFund.align, true));
        tr.appendChild(createCell(row.returnSubsidy.value, row.returnSubsidy.align, true));
        tr.appendChild(createCell(row.returnAdmin.value, row.returnAdmin.align, true));
        tr.appendChild(createCell(row.otherIncome.value, row.otherIncome.align, true));
        tr.appendChild(createCell(row.mistakeIncome.value, row.mistakeIncome.align, true));
        tr.appendChild(createCell(row.totalIncome.value, row.totalIncome.align, true));
        tr.appendChild(createCell(row.expPrincipal.value, row.expPrincipal.align, true));
        tr.appendChild(createCell(row.expInterest.value, row.expInterest.align, true));
        tr.appendChild(createCell(row.expPenalty.value, row.expPenalty.align, true));
        tr.appendChild(createCell(row.expOverdueInterest.value, row.expOverdueInterest.align, true));
        tr.appendChild(createCell(row.expPending.value, row.expPending.align, true));
        tr.appendChild(createCell(row.expBankInterest.value, row.expBankInterest.align, true));
        tr.appendChild(createCell(row.expExtraDeposit.value, row.expExtraDeposit.align, true));
        tr.appendChild(createCell(row.expFundRemain.value, row.expFundRemain.align, true));
        tr.appendChild(createCell(row.expSubsidyRemain.value, row.expSubsidyRemain.align, true));
        tr.appendChild(createCell(row.expAdminRemain.value, row.expAdminRemain.align, true));
        tr.appendChild(createCell(row.provSubsidy.value, row.provSubsidy.align, true));
        tr.appendChild(createCell(row.provFund.value, row.provFund.align, true));
        tr.appendChild(createCell(row.provLoan.value, row.provLoan.align, true));
        tr.appendChild(createCell(row.provTrainIn.value, row.provTrainIn.align, true));
        tr.appendChild(createCell(row.provTrainOut.value, row.provTrainOut.align, true));
        tr.appendChild(createCell(row.provMeetingFee.value, row.provMeetingFee.align, true));
        tr.appendChild(createCell(row.provMeeting.value, row.provMeeting.align, true));
        tr.appendChild(createCell(row.provTravel.value, row.provTravel.align, true));
        tr.appendChild(createCell(row.provPerdiem.value, row.provPerdiem.align, true));
        tr.appendChild(createCell(row.provHotel.value, row.provHotel.align, true));
        tr.appendChild(createCell(row.provMaterial.value, row.provMaterial.align, true));
        tr.appendChild(createCell(row.provElectric.value, row.provElectric.align, true));
        tr.appendChild(createCell(row.provPhone.value, row.provPhone.align, true));
        tr.appendChild(createCell(row.provInternet.value, row.provInternet.align, true));
        tr.appendChild(createCell(row.provPost.value, row.provPost.align, true));
        tr.appendChild(createCell(row.provWater.value, row.provWater.align, true));
        tr.appendChild(createCell(row.provBankFee.value, row.provBankFee.align, true));
        tr.appendChild(createCell(row.provRefund.value, row.provRefund.align, true));
        tr.appendChild(createCell(row.provRepair.value, row.provRepair.align, true));
        tr.appendChild(createCell(row.provAsset.value, row.provAsset.align, true));
        tr.appendChild(createCell(row.provOvertime.value, row.provOvertime.align, true));
        tr.appendChild(createCell(row.provCourt.value, row.provCourt.align, true));
        tr.appendChild(createCell(row.provHire.value, row.provHire.align, true));
        tr.appendChild(createCell(row.provPR.value, row.provPR.align, true));
        tr.appendChild(createCell(row.provActivity.value, row.provActivity.align, true));
        tr.appendChild(createCell(row.provOther.value, row.provOther.align, true));
        tr.appendChild(createCell(row.provTotalExp.value, row.provTotalExp.align, true));
        tr.appendChild(createCell(row.balance.value, row.balance.align, true));
        tr.appendChild(createCell(row.note.value, row.note.align)); // note is not a number
        tr.appendChild(createCell(row.diff.value, row.diff.align, true));

        tbody.appendChild(tr);
      });

      // Initialize DataTables after populating the table
      if ($.fn.DataTable.isDataTable('#mainTable')) {
        $('#mainTable').DataTable().destroy();
      }
      $('#mainTable').DataTable({
        paging: false,
        scrollX: true,
        scrollY: "65vh", // Set height relative to viewport height
        scrollCollapse: true,
        info: false, // Hide "Showing X of Y entries"
        language: {
          search: "ค้นหาในตาราง:",
          zeroRecords: "ไม่พบข้อมูลที่ตรงกัน",
        }
      });

    } catch (err) {
      console.error("โหลดข้อมูลผิดพลาด:", err);
      // Display error to the user
      const tbody = document.querySelector("#mainTable tbody");
      tbody.innerHTML = `<tr><td colspan="60" style="text-align:center; color:red;">เกิดข้อผิดพลาดในการโหลดข้อมูล: ${err.message}</td></tr>`;
    }
  }

  // Run the function to fetch and display data when the page loads
  fetchData();
</script>
</body>
</html>
