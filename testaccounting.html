<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ทะเบียนคุมการรับ-จ่ายเงินฝากคลัง (รหัส 10962)</title>

  <!-- โหลด DataTables และ jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      background: url('https://www.dga.or.th/wp-content/uploads/2020/05/bg_main.png') no-repeat center center fixed;
      background-size: cover;
    }
    header {
      background: rgba(0, 51, 102, 0.9);
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    header img {
      height: 80px;
    }
    h1 {
      margin: 10px 0 0 0;
      font-size: 26px;
    }
    .container {
      margin: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    table.dataTable thead th {
      background: #003366;
      color: white;
      text-align: center;
      font-size: 14px;
      white-space: nowrap;
    }
    table.dataTable tbody td {
      font-size: 13px;
      text-align: right;
    }
    table.dataTable tbody td:first-child,
    table.dataTable tbody td:nth-child(2) {
      text-align: center;
    }
    .merge-row td {
      background-color: #fffacd !important;
      font-weight: bold !important;
      text-align: center;
      border: 1px solid #ccc !important;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Seal_of_the_Ministry_of_Finance_of_Thailand.svg/1200px-Seal_of_the_Ministry_of_Finance_of_Thailand.svg.png" alt="Logo">
    <h1>ทะเบียนคุมการรับ-จ่ายเงินฝากคลัง (รหัส 10962)</h1>
  </header>

  <div class="container">
    <table id="mainTable" class="display nowrap stripe hover" style="width:100%">
      <thead>
        <tr>
          <th>ลำดับ</th>
          <th>จังหวัด</th>
          <th>เงินฝากต้นงวด</th>
          <th>เงินกองทุน</th>
          <th>เงินอุดหนุน</th>
          <th>ค่าบริหาร</th>
          <th>คืนเงินฝาก</th>
          <th>เงินต้น</th>
          <th>ดอกเบี้ย</th>
          <th>ค่าปรับ</th>
          <th>ดอกเบี้ยค้าง</th>
          <th>คงค้าง</th>
          <th>ดอกเบี้ยธนาคาร</th>
          <th>เงินฝากเพิ่มเติม</th>
          <th>คืนกองทุน</th>
          <th>คืนเงินอุดหนุน</th>
          <th>คืนค่าบริหาร</th>
          <th>รายได้อื่น</th>
          <th>รายได้ผิดพลาด</th>
          <th>รวมรายได้</th>
          <th>ค่าใช้จ่ายเงินต้น</th>
          <th>ค่าใช้จ่ายดอกเบี้ย</th>
          <th>ค่าใช้จ่ายค่าปรับ</th>
          <th>ค่าใช้จ่ายดอกเบี้ยค้าง</th>
          <th>ค่าใช้จ่ายคงค้าง</th>
          <th>ค่าใช้จ่ายดอกเบี้ยธนาคาร</th>
          <th>ค่าใช้จ่ายเงินฝากเพิ่มเติม</th>
          <th>เงินกองทุนคงเหลือ</th>
          <th>เงินอุดหนุนคงเหลือ</th>
          <th>ค่าบริหารคงเหลือ</th>
          <th>ค่าใช้จ่ายอุดหนุนจังหวัด</th>
          <th>ค่าใช้จ่ายกองทุนจังหวัด</th>
          <th>ค่าใช้จ่ายเงินกู้จังหวัด</th>
          <th>อบรมภายในจังหวัด</th>
          <th>อบรมภายนอกจังหวัด</th>
          <th>ค่าเบี้ยประชุม</th>
          <th>ค่าใช้จ่ายการประชุม</th>
          <th>ค่าเดินทาง</th>
          <th>ค่าเบี้ยเลี้ยง</th>
          <th>ค่าที่พัก</th>
          <th>ค่าวัสดุ</th>
          <th>ค่าไฟฟ้า</th>
          <th>ค่าโทรศัพท์</th>
          <th>ค่าอินเทอร์เน็ต</th>
          <th>ค่าไปรษณีย์</th>
          <th>ค่าน้ำประปา</th>
          <th>ค่าธรรมเนียมธนาคาร</th>
          <th>คืนเงิน</th>
          <th>ค่าซ่อมแซม</th>
          <th>ค่าสินทรัพย์</th>
          <th>ค่าโอที</th>
          <th>ค่าศาล</th>
          <th>ค่าจ้าง</th>
          <th>ค่าประชาสัมพันธ์</th>
          <th>ค่าใช้จ่ายกิจกรรม</th>
          <th>ค่าใช้จ่ายอื่น</th>
          <th>รวมค่าใช้จ่ายจังหวัด</th>
          <th>ยอดคงเหลือ</th>
          <th>หมายเหตุ</th>
          <th>ผลต่าง</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

    function formatNumber(num) {
      if (num === null || num === undefined || num === "") return "";
      return Number(num).toLocaleString("th-TH", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        const tbody = document.querySelector("#mainTable tbody");
        tbody.innerHTML = "";

        data.rows.forEach((row, index) => {
          const tr = document.createElement("tr");

          if (row.province === "รวมระหว่างเดือน") {
            const td = document.createElement("td");
            td.colSpan = 59;
            td.textContent = "รวมระหว่างเดือน";
            tr.classList.add("merge-row");
            tr.appendChild(td);
          } else {
            tr.innerHTML = `
              <td>${index+1}</td>
              <td>${row.province}</td>
              <td>${formatNumber(row.start)}</td>
              <td>${formatNumber(row.fund)}</td>
              <td>${formatNumber(row.subsidy)}</td>
              <td>${formatNumber(row.admin)}</td>
              <td>${formatNumber(row.returnDeposit)}</td>
              <td>${formatNumber(row.principal)}</td>
              <td>${formatNumber(row.interest)}</td>
              <td>${formatNumber(row.penalty)}</td>
              <td>${formatNumber(row.overdueInterest)}</td>
              <td>${formatNumber(row.pending)}</td>
              <td>${formatNumber(row.bankInterest)}</td>
              <td>${formatNumber(row.extraDeposit)}</td>
              <td>${formatNumber(row.returnFund)}</td>
              <td>${formatNumber(row.returnSubsidy)}</td>
              <td>${formatNumber(row.returnAdmin)}</td>
              <td>${formatNumber(row.otherIncome)}</td>
              <td>${formatNumber(row.mistakeIncome)}</td>
              <td>${formatNumber(row.totalIncome)}</td>
              <td>${formatNumber(row.expPrincipal)}</td>
              <td>${formatNumber(row.expInterest)}</td>
              <td>${formatNumber(row.expPenalty)}</td>
              <td>${formatNumber(row.expOverdueInterest)}</td>
              <td>${formatNumber(row.expPending)}</td>
              <td>${formatNumber(row.expBankInterest)}</td>
              <td>${formatNumber(row.expExtraDeposit)}</td>
              <td>${formatNumber(row.expFundRemain)}</td>
              <td>${formatNumber(row.expSubsidyRemain)}</td>
              <td>${formatNumber(row.expAdminRemain)}</td>
              <td>${formatNumber(row.provSubsidy)}</td>
              <td>${formatNumber(row.provFund)}</td>
              <td>${formatNumber(row.provLoan)}</td>
              <td>${formatNumber(row.provTrainIn)}</td>
              <td>${formatNumber(row.provTrainOut)}</td>
              <td>${formatNumber(row.provMeetingFee)}</td>
              <td>${formatNumber(row.provMeeting)}</td>
              <td>${formatNumber(row.provTravel)}</td>
              <td>${formatNumber(row.provPerdiem)}</td>
              <td>${formatNumber(row.provHotel)}</td>
              <td>${formatNumber(row.provMaterial)}</td>
              <td>${formatNumber(row.provElectric)}</td>
              <td>${formatNumber(row.provPhone)}</td>
              <td>${formatNumber(row.provInternet)}</td>
              <td>${formatNumber(row.provPost)}</td>
              <td>${formatNumber(row.provWater)}</td>
              <td>${formatNumber(row.provBankFee)}</td>
              <td>${formatNumber(row.provRefund)}</td>
              <td>${formatNumber(row.provRepair)}</td>
              <td>${formatNumber(row.provAsset)}</td>
              <td>${formatNumber(row.provOvertime)}</td>
              <td>${formatNumber(row.provCourt)}</td>
              <td>${formatNumber(row.provHire)}</td>
              <td>${formatNumber(row.provPR)}</td>
              <td>${formatNumber(row.provActivity)}</td>
              <td>${formatNumber(row.provOther)}</td>
              <td>${formatNumber(row.provTotalExp)}</td>
              <td>${formatNumber(row.balance)}</td>
              <td>${row.note || ""}</td>
              <td>${formatNumber(row.diff)}</td>
            `;
          }

          tbody.appendChild(tr);
        });

        if ($.fn.DataTable.isDataTable('#mainTable')) {
          $('#mainTable').DataTable().clear().destroy();
        }

        const table = $('#mainTable').DataTable({
          paging: true,
          pageLength: 10,
          lengthMenu: [ [10, 25, 50, -1], [10, 25, 50, "ทั้งหมด"] ],
          fixedHeader: true,
          scrollX: true,
          scrollCollapse: true,
          language: {
            search: "ค้นหา:",
            lengthMenu: "แสดง _MENU_ รายการ",
            info: "แสดง _START_ ถึง _END_ จากทั้งหมด _TOTAL_ รายการ",
            infoEmpty: "ไม่มีข้อมูล",
            zeroRecords: "ไม่พบข้อมูลที่ตรงกัน",
            paginate: {
              first: "หน้าแรก", last: "หน้าสุดท้าย", next: "ถัดไป", previous: "ก่อนหน้า"
            }
          }
        });

        table.on('draw', function () {
          table.fixedHeader.adjust();
        });

      } catch (err) {
        console.error("โหลดข้อมูลผิดพลาด:", err);
      }
    }

    fetchData();
  </script>
</body>
</html>
