<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ ‚Äî Mainpoints</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --pink-main: #f8bbd0;
    --pink-deep: #880e4f;
    --pink-alt: rgba(255,182,193,0.12);
    --table-border: #c97a9b;
    --header-bg: rgba(255,255,255,0.95);
  } 

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Sarabun',sans-serif;
    background: linear-gradient(to bottom right,#ffe6f0,#ffd1e6);
    display:flex;
    justify-content:center;
    padding:20px;
    min-height:100vh;
  }

  .container{
    width:100%;
    max-width:1400px;
    background:var(--header-bg);
    border-radius:20px;
    padding:22px;
    position:relative;
    box-shadow:0 8px 25px rgba(233,30,99,0.15);
    display:flex;
    flex-direction:column;
    gap:12px;
    min-height:70vh;
  }

  /* logos top-right */
  .logos-top{
    position:absolute;
    right:22px;
    top:18px;
    display:flex;
    gap:12px;
  }
  .logos-top img{height:56px; display:block;}

  /* header (title + small info) sticky at top */
  .header-block{
    position:sticky;
    top:0;
    z-index:40;
    background:transparent;
    padding-top:6px;
    padding-bottom:6px;
  }
  .title{
    text-align:center;
    margin:0;
    color:var(--pink-deep);
    font-size:28px;
    font-weight:700;
    line-height:1.05;
  }
  .subtitle{
    text-align:center;
    color:#880e4f;
    margin-top:8px;
    margin-bottom:4px;
    font-weight:700;
  }

  /* report date at top-right (inside header-block) */
  .report-meta{
    display:flex;
    justify-content:flex-end;
    align-items:center;
    gap:12px;
    margin-top:6px;
  }
  .report-date{
    color:var(--pink-deep);
    font-weight:700;
  }

  /* toolbar: left home + right controls (dropdown, search, download) */
  .toolbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin-top:6px;
    z-index:30;
  }
  .left-tools{display:flex; align-items:center; gap:8px;}
  .left-tools button{
    background:var(--pink-main);
    color:var(--pink-deep);
    border:0;
    padding:8px 12px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    display:flex; gap:8px; align-items:center;
  }
  .left-tools button img{height:18px;}

  .right-tools{display:flex; align-items:center; gap:8px;}
  .right-tools select, .right-tools input, .right-tools button{
    font-family:'Sarabun';
    padding:7px 10px;
    border-radius:8px;
    border:1px solid #f48fb1;
    font-size:0.95rem;
  }
  .right-tools input{width:220px;}
  .download-btn{background:var(--pink-main); color:var(--pink-deep); border:0; cursor:pointer; font-weight:700;}

  /* table area */
  .table-wrapper{
    background:white;
    border-radius:12px;
    overflow:auto;
    box-shadow:0 4px 12px rgba(0,0,0,0.03);
    padding:8px;
    border:1px solid rgba(233,30,99,0.06);
    flex:1;
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:0.92rem;
    min-width:1100px; /* keep layout */
  }
  th, td{
    border:1px solid var(--table-border);
    padding:8px 6px;
    text-align:center;
    vertical-align:middle;
    white-space:nowrap;
  }
  thead th{
    background:var(--pink-main);
    color:var(--pink-deep);
    font-weight:700;
  }

  /* sticky for thead rows: row1 and row2 will be sticky with dynamic top */
  thead tr th{ position:relative; } /* baseline */
  thead tr.sticky-row-1 th{ position:sticky; top:0; z-index:30; }
  thead tr.sticky-row-2 th{ position:sticky; z-index:29; }

  tbody tr:nth-child(even) td{ background:var(--pink-alt); }
  tbody tr:nth-child(odd) td{ background:rgba(255,192,203,0.05); }

  .empty-row td{ text-align:center; color:#c62828; font-style:italic; padding:16px; }

  /* small responsive */
  @media (max-width:900px){
    .right-tools input{width:140px;}
    .title{font-size:22px;}
  }
</style>
</head>
<body>
  <div class="container" id="container">
    <div class="logos-top">
      <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ ‡πÉ‡∏ä‡πâ url -->
      <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Women Fund Logo">
    </div>

    <div class="header-block">
      <h1 class="title">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®.2569</h1>
      <div class="subtitle">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï "‡∏û.‡∏¢.68"</div>
      <div class="report-meta">
        <div id="reportDate" class="report-date">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
      </div>
    </div>

    <div class="toolbar">
      <div class="left-tools">
        <button id="btnHome" onclick="goHome()">
          <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="home"> ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
        </button>
      </div>

      <div class="right-tools">
        <label for="sheetSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
        <select id="sheetSelect" onchange="onSheetChange(this.value)"></select>

        <input id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" oninput="applyFilter()" />

        <button id="downloadBtn" class="download-btn" onclick="downloadExcel()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>
      </div>
    </div>

    <div class="table-wrapper" id="tableWrapper">
      <table id="mainTable" aria-describedby="reportDate">
        <thead id="tableHead"></thead>
        <tbody id="tableBody">
          <tr class="empty-row"><td colspan="30">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

<script>
/*
  mainpoints.html
  - ‡πÄ‡∏Å‡πá‡∏ö API_URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô Google Sheet ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á JSON
  - ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ï‡∏à‡∏≤‡∏Å endpoint (?listSheets=true) ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá fallback ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ DEFAULT_SHEET
  - ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á: API_URL (Apps Script web app URL) ‡πÅ‡∏•‡∏∞ DEFAULT_SHEET
*/

const API_URL = 'https://script.google.com/macros/s/AKfycbzN66BjPv1v_apObuMvSfi8j0oma0-Fm0-0NfCZ3NaK9azw3Rzahb8rdvRpmQGuvdTx/exec';
const DEFAULT_SHEET = '‡∏û.‡∏¢.68';

// ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ä‡∏µ‡∏ï‡πÉ‡∏ô sheet data (0-based)
// ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏µ‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠ 1-2 (index 0,1 ‡πÉ‡∏ô data)
// ‡πÅ‡∏ñ‡∏ß header ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠ ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 4-5 ‡πÉ‡∏ô sheet ‚Üí 0-based index = 3 ‡πÅ‡∏•‡∏∞ 4
const START_HEADER_ROW_INDEX = 3; // row 4
const END_HEADER_ROW_INDEX = 4;   // row 5
const START_BODY_ROW_INDEX = 5;   // row 6 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ

let currentSheet = DEFAULT_SHEET;
let lastFetched = null;
let currentData = null;
let currentMerged = null;

/* --- helper: fetch sheet list (try to call endpoint '?listSheets=true') --- */
async function loadSheetList() {
  try {
    const res = await fetch(API_URL + '?listSheets=true');
    if (!res.ok) throw new Error('no sheet list');
    const json = await res.json();
    // expect response like { sheets: ['‡∏û.‡∏¢.68','‡∏ò.‡∏Ñ.68', ...] } or something similar
    if (Array.isArray(json.sheets) && json.sheets.length) return json.sheets;
    // if server returns sheetName only, fallback
    if (json.sheetName) return [json.sheetName];
    return [DEFAULT_SHEET];
  } catch(e){
    // fallback: try to read default (single option)
    return [DEFAULT_SHEET];
  }
}

/* --- build dropdown of sheets --- */
async function populateSheetSelect(){
  const select = document.getElementById('sheetSelect');
  select.innerHTML = '';
  const sheets = await loadSheetList();
  sheets.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = s;
    select.appendChild(opt);
  });
  // set current if exists
  if (sheets.includes(DEFAULT_SHEET)) {
    select.value = DEFAULT_SHEET;
    currentSheet = DEFAULT_SHEET;
  } else {
    select.selectedIndex = 0;
    currentSheet = select.value;
  }
}

/* --- fetch data for a sheet --- */
async function fetchSheetData(sheetName){
  try {
    const url = `${API_URL}?sheetName=${encodeURIComponent(sheetName)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Apps Script');
    const json = await res.json();
    if (json.error) throw new Error(json.error || 'Error from server');
    // expect { sheetName, data: [...], merged: [...] }
    return json;
  } catch (err) {
    throw err;
  }
}

/* --- apply merged cells to a 2D array region (header building) --- */
/*
  merged items expected: { row: <0-based>, col: <0-based>, height:, width:, value: }
  We will pass headerData (slice) and merged filtered and adjusted (row offset subtracted)
*/
function buildHeaderHtml(headerData, mergedInfo){
  if(!headerData || !headerData.length) return '<tr><th>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á</th></tr>';
  const rows = headerData.length;
  const cols = Math.max(...headerData.map(r => r.length));
  // prepare hidden map
  const hidden = Array.from({length:rows}, () => Array(cols).fill(false));
  let html = '';
  for(let r=0;r<rows;r++){
    html += '<tr' + (r===0 ? ' class="sticky-row-1"':'') + (r===1 ? ' class="sticky-row-2"':'') + '>';
    for(let c=0;c<cols;c++){
      if(hidden[r][c]) continue;
      // find merge at this header local position
      const merge = mergedInfo.find(m => m.row === r && m.col === c);
      let attrs = '';
      if(merge && (merge.height>1 || merge.width>1)){
        attrs += ` rowspan="${merge.height}" colspan="${merge.width}"`;
        for(let i=0;i<merge.height;i++){
          for(let j=0;j<merge.width;j++){
            if(i===0 && j===0) continue;
            if(r+i < rows && c+j < cols) hidden[r+i][c+j] = true;
          }
        }
      }
      const content = (headerData[r] && headerData[r][c] !== undefined && headerData[r][c] !== null) ? headerData[r][c] : '';
      html += `<th ${attrs}>${escapeHtml(String(content))}</th>`;
    }
    html += '</tr>';
  }
  return html;
}

function escapeHtml(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* --- render body rows (no merged processing for body, but we honor full columns) --- */
function buildBodyHtml(bodyData){
  if(!bodyData || !bodyData.length) return '<tr class="empty-row"><td colspan="30">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
  let html = '';
  const cols = Math.max(...bodyData.map(r=>r.length));
  bodyData.forEach((row, rIdx) => {
    html += '<tr>';
    for(let c=0;c<cols;c++){
      const v = row[c] !== undefined && row[c] !== null ? row[c] : '';
      // format numbers
      const cellHtml = (typeof v === 'number') ? numberWithCommas(v) : escapeHtml(String(v));
      html += `<td>${cellHtml}</td>`;
    }
    html += '</tr>';
  });
  return html;
}
function numberWithCommas(x){
  return x.toLocaleString('th-TH');
}

/* --- main refresh function --- */
async function loadAndRenderSheet(sheetName){
  const headEl = document.getElementById('tableHead');
  const bodyEl = document.getElementById('tableBody');
  const reportDateEl = document.getElementById('reportDate');

  headEl.innerHTML = '';
  bodyEl.innerHTML = '<tr class="empty-row"><td colspan="30">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';
  try {
    const json = await fetchSheetData(sheetName);
    const allData = json.data || [];
    const merged = json.merged || [];
    currentData = allData;
    currentMerged = merged;
    lastFetched = new Date();

    // headerPart: use rows 0..START_HEADER_ROW_INDEX-1 for info above table
    // In your sheet the "report title lines" are typically rows 1-3, but we'll read row 0-2 (if exist)
    const reportInfoRows = allData.slice(0, START_HEADER_ROW_INDEX);
    // build small header text from reportInfoRows (concatenate each row's non-empty cells)
    const headerText = reportInfoRows.map(r => r.filter(c => c !== null && c !== '').join(' ')).filter(s => s).join('<br>');
    if(headerText) {
      // replace subtitle line center
      const subtitle = document.querySelector('.subtitle');
      if(subtitle) subtitle.innerHTML = headerText;
    }

    // report date: look for "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" in first 6 rows
    let foundDate = '';
    for(let i=0;i<Math.min(6, allData.length); i++){
      const row = allData[i];
      for(const cell of row){
        if(typeof cell === 'string' && cell.includes('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà')){
          foundDate = cell.trim();
          break;
        }
      }
      if(foundDate) break;
    }
    reportDateEl.textContent = foundDate || '';

    // headerData slice (rows 4-5 in sheet -> indices START_HEADER_ROW_INDEX .. END_HEADER_ROW_INDEX)
    const headerData = allData.slice(START_HEADER_ROW_INDEX, END_HEADER_ROW_INDEX + 1);
    // adjust merged info relevant to header region
    const headerMerged = merged
      .filter(m => m.row >= START_HEADER_ROW_INDEX && m.row <= END_HEADER_ROW_INDEX)
      .map(m => ({...m, row: m.row - START_HEADER_ROW_INDEX, col: m.col}));

    headEl.innerHTML = buildHeaderHtml(headerData, headerMerged);

    // body data
    const bodyData = allData.slice(START_BODY_ROW_INDEX);
    bodyEl.innerHTML = buildBodyHtml(bodyData);

    // after rendering, compute sticky offsets dynamically:
    applyStickyOffsets();

    // store current sheet name
    currentSheet = sheetName;

  } catch(err){
    headEl.innerHTML = '';
    bodyEl.innerHTML = `<tr class="empty-row"><td colspan="30">‚ùå ${escapeHtml(err.message || String(err))}</td></tr>`;
    document.getElementById('reportDate').textContent = '';
    console.error(err);
  }
}

/* --- compute header heights and set CSS top for sticky header rows --- */
function applyStickyOffsets(){
  // header-block height
  const headerBlock = document.querySelector('.header-block');
  const headerBlockRect = headerBlock ? headerBlock.getBoundingClientRect() : {height:0};
  const headerHeight = headerBlock ? headerBlock.offsetHeight : 0;

  // find first two rows of thead
  const thead = document.getElementById('tableHead');
  if(!thead) return;
  const rows = thead.querySelectorAll('tr');
  let row1 = rows[0];
  let row2 = rows[1];

  // set top offsets
  if(row1){
    // make sure class sticky-row-1 present
    row1.classList.add('sticky-row-1');
    // set style top = headerBlock height (so header-block stays above)
    row1.style.top = headerBlock.offsetHeight + 'px';
  }
  if(row2){
    row2.classList.add('sticky-row-2');
    // top for second header should be headerBlock + row1 height
    const r1h = row1 ? row1.getBoundingClientRect().height : 0;
    row2.style.top = (headerBlock.offsetHeight + r1h) + 'px';
  }

  // also ensure table wrapper has appropriate z-index so header-block doesn't hide content
  const tableWrapper = document.getElementById('tableWrapper');
  if(tableWrapper) tableWrapper.style.zIndex = 10;
}

/* --- filter/search --- */
function applyFilter(){
  const q = (document.getElementById('searchInput').value || '').toLowerCase().trim();
  const bodyRows = document.querySelectorAll('#tableBody tr');
  bodyRows.forEach(tr => {
    const text = tr.innerText.toLowerCase();
    tr.style.display = text.includes(q) ? '' : 'none';
  });
}

/* --- change sheet handler --- */
function onSheetChange(sheetName){
  if(!sheetName) return;
  loadAndRenderSheet(sheetName);
}

/* --- go home (user can change target as needed) --- */
function goHome(){
  // placeholder: if you have a menu page, put path here
  // window.location.href = 'Menu.html';
  alert('‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏£‡∏¥‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)');
}

/* --- download Excel using SheetJS (minimal styling for headers) --- */
async function downloadExcel(){
  try{
    if(!currentData || !currentData.length){
      alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
      return;
    }
    // load SheetJS if not loaded
    if(typeof XLSX === 'undefined'){
      await loadScript('https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js');
    }
    const ws = XLSX.utils.aoa_to_sheet(currentData);
    // apply simple style to first few header rows (note: SheetJS community styling limited)
    // append to workbook
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, currentSheet || 'report');
    const fileName = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô_${(currentSheet||'report')}.xlsx`;
    XLSX.writeFile(wb, fileName);
  } catch(e){
    console.error(e);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î: ' + e.message);
  }
}
function loadScript(src){
  return new Promise((resolve, reject)=>{
    const s = document.createElement('script');
    s.src = src;
    s.onload = ()=>resolve();
    s.onerror = (e)=>reject(e);
    document.head.appendChild(s);
  });
}

/* --- util: set up page on load --- */
async function init(){
  await populateSheetSelect();
  // render default sheet
  const select = document.getElementById('sheetSelect');
  const initialSheet = select.value || DEFAULT_SHEET;
  // set subtitle initial
  const subtitle = document.querySelector('.subtitle');
  if(subtitle) subtitle.textContent = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï "${initialSheet}"`;
  await loadAndRenderSheet(initialSheet);

  // watch resize to recompute sticky offsets
  window.addEventListener('resize', applyStickyOffsets);
  // ensure offsets after fonts load
  setTimeout(applyStickyOffsets, 400);
}

/* --- helper: escape and number formatting already above --- */
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
