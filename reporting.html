<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏™‡∏ï‡∏£‡∏µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (for JSX in browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    body { font-family: 'Sarabun', sans-serif; }
    @media print {
      .no-print { display: none !important; }
      table { font-size: 8pt; }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const API_URL = 'https://script.google.com/macros/s/AKfycbxIDBqQkRdzRZsFsqTrxcdCg0FXY-NoxZ8UaFFKNG9oOGWr3G67vYmjw4vEpXoKLbH1_Q/exec';

    const Quarter = {
      Q1_2: '‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ 1-2',
      Q3_4: '‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ 3-4'
    };

    const THEMES = {
      [Quarter.Q1_2]: {
        main: '#f8bbd0',
        dark: '#880e4f',
        gradient: 'linear-gradient(to bottom right, #ffe6f0, #ffd1e6)',
        border: '#f48fb1'
      },
      [Quarter.Q3_4]: {
        main: '#e1bee7',
        dark: '#6a1b9a',
        gradient: 'linear-gradient(to bottom right, #f3e5f5, #e1bee7)',
        border: '#ce93d8'
      }
    };

    const START_HEADER_ROW = 3;
    const END_HEADER_ROW = 4;
    const START_BODY_ROW = 5;

    function App() {
      const [quarter, setQuarter] = React.useState(Quarter.Q1_2);
      const [data, setData] = React.useState([]);
      const [loading, setLoading] = React.useState(true);
      const [search, setSearch] = React.useState('');
      const theme = THEMES[quarter];

      React.useEffect(() => {
        setLoading(true);
        fetch(`${API_URL}?sheetName=${encodeURIComponent(quarter)}`)
          .then(r => r.json())
          .then(res => {
            setData(res.data || res);
            setLoading(false);
          });
      }, [quarter]);

      const bodyRows = React.useMemo(() => {
        const rows = data.slice(START_BODY_ROW);
        if (!search) return rows;
        return rows.filter(r => r.some(c => String(c).toLowerCase().includes(search.toLowerCase())));
      }, [data, search]);

      return (
        <div className="min-h-screen flex justify-center p-6" style={{ background: theme.gradient }}>
          <div className="bg-white w-full max-w-[1700px] rounded-3xl p-6 shadow-2xl">

            <h1 className="text-center font-bold text-2xl whitespace-pre-line" style={{ color: theme.dark }}>
              {data.slice(0,2).map(r=>r.join(' ')).join('\n')}
            </h1>

            <div className="text-right font-bold mt-2" style={{ color: theme.dark }}>
              {data[2]?.join(' ')}
            </div>

            <div className="flex gap-4 mt-6 items-center no-print">
              <select
                value={quarter}
                onChange={e => setQuarter(e.target.value)}
                className="px-3 py-2 rounded-xl border font-bold"
                style={{ borderColor: theme.border }}
              >
                <option>{Quarter.Q1_2}</option>
                <option>{Quarter.Q3_4}</option>
              </select>

              <input
                placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
                value={search}
                onChange={e => setSearch(e.target.value)}
                className="px-4 py-2 border rounded-xl flex-1"
              />

              <button
                onClick={() => window.print()}
                className="px-5 py-2 rounded-xl font-bold"
                style={{ background: theme.main, color: theme.dark }}
              >
                üñ® PDF
              </button>

              <button
                onClick={() => {
                  const ws = XLSX.utils.aoa_to_sheet(data.slice(START_HEADER_ROW));
                  const wb = XLSX.utils.book_new();
                  XLSX.utils.book_append_sheet(wb, ws, '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
                  XLSX.writeFile(wb, '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô.xlsx');
                }}
                className="px-5 py-2 rounded-xl font-bold"
                style={{ background: theme.main, color: theme.dark }}
              >
                üìä Excel
              </button>
            </div>

            <div className="mt-6 overflow-auto max-h-[65vh] border rounded-xl">
              <table className="w-full border-collapse">
                <thead>
                  {data.slice(START_HEADER_ROW, END_HEADER_ROW+1).map((r,i)=>(
                    <tr key={i}>
                      {r.map((c,j)=>(
                        <th key={j}
                          className="border p-2 sticky top-0"
                          style={{ background: theme.main, color: theme.dark }}>
                          {c}
                        </th>
                      ))}
                    </tr>
                  ))}
                </thead>
                <tbody>
                  {loading && (
                    <tr><td colSpan="30" className="p-10 text-center italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                  )}
                  {!loading && bodyRows.map((r,i)=>(
                    <tr key={i} className={i%2?'bg-gray-50':''}>
                      {r.map((c,j)=>(
                        <td key={j} className="border p-2">{c}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
