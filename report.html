<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>à¸£à¸²à¸¢à¸‡à¸²à¸™à¸œà¸¥à¸à¸­à¸‡à¸—à¸¸à¸™à¸à¸±à¸’à¸™à¸²à¸šà¸—à¸šà¸²à¸—à¸ªà¸•à¸£à¸µ</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
<style>
/* CSS: à¸„à¸‡à¸£à¸¹à¸›à¹à¸šà¸šà¹€à¸”à¸´à¸¡à¹à¸¥à¸°à¹€à¸à¸´à¹ˆà¸¡à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ */
body {
Â  font-family: 'Sarabun', sans-serif;
Â  margin: 0;
Â  padding: 20px;
Â  background: linear-gradient(to bottom right, #ffe6f0, #ffd1e6);
Â  display: flex;
Â  justify-content: center;
Â  min-height: 100vh;
}
.container {
Â  width: 100%;
Â  max-width: 1400px;
Â  background: rgba(255,255,255,0.95);
Â  border-radius: 25px;
Â  padding: 30px;
Â  box-shadow: 0 8px 25px rgba(233, 30, 99, 0.25);
Â  position: relative;
}
.logos-top {
Â  position: absolute;
Â  top: 20px;
Â  right: 20px;
Â  display: flex;
Â  gap: 10px;
}
.logos-top img { height: 55px; }

#reportInfo {
Â  text-align: center;
Â  color: #880e4f;
Â  font-weight: bold;
Â  margin: 20px 0 10px 0;
Â  line-height: 1.6em;
}

/* âœ… à¹à¸à¹‰à¹„à¸‚à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰à¸­à¸¢à¸¹à¹ˆà¸¡à¸¸à¸¡à¸‚à¸§à¸² à¹ƒà¸•à¹‰à¸«à¸±à¸§à¸‚à¹‰à¸­à¸«à¸¥à¸±à¸ */
#reportDate {
Â  position: absolute;
Â  top: 120px; /* à¸›à¸£à¸±à¸šà¸„à¹ˆà¸²à¹ƒà¸«à¹‰à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸­à¸¢à¸¹à¹ˆà¹ƒà¸•à¹‰ "à¸›à¸£à¸°à¸ˆà¸³à¹€à¸”à¸·à¸­à¸™ à¸à¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™ à¸.à¸¨. 2568" */
Â  right: 30px; /* à¹ƒà¸à¸¥à¹‰à¸‚à¸­à¸šà¸‚à¸§à¸² */
Â  color: #880e4f;
Â  font-weight: bold;
Â  font-size: 0.95rem;
Â  z-index: 10;
}

.filter-bar {
Â  text-align: right;
Â  margin-bottom: 10px;
}
.filter-bar input {
Â  padding: 6px 10px;
Â  border-radius: 8px;
Â  border: 1px solid #f48fb1;
Â  font-family: 'Sarabun';
Â  font-size: 0.9rem;
}

.table-wrapper {
Â  overflow: auto;
Â  max-height: 80vh;
Â  border-radius: 12px;
Â  box-shadow: 0 4px 12px rgba(233,30,99,0.1);
Â  background: white;
}

table {
Â  width: 100%;
Â  border-collapse: collapse;
Â  font-size: 0.9rem;
}
th, td {
Â  border: 1px solid #c97a9b;
Â  padding: 6px 8px;
Â  text-align: center;
Â  vertical-align: middle;
Â  white-space: nowrap;
}

/* âœ… Sticky Header à¸«à¸¥à¸²à¸¢à¸šà¸£à¸£à¸—à¸±à¸” */
thead th {
Â  background-color: #f8bbd0;
Â  color: #880e4f;
Â  font-weight: 700;
Â  border: 1.5px solid #b36a84;
Â  z-index: 5;
}
thead tr:nth-child(1) th { position: sticky; top: 0; }
thead tr:nth-child(2) th { position: sticky; top: 32px; }
thead tr:nth-child(3) th { position: sticky; top: 64px; }

/* âœ… à¹€à¸ªà¹‰à¸™à¸‚à¸­à¸šà¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡à¸¥à¹ˆà¸²à¸‡à¸ªà¸¸à¸” */
thead tr:last-child th {
Â  border-bottom: 2.5px solid #880e4f;
}

tr:nth-child(even) td { background-color: rgba(255,182,193,0.12); }
tr:nth-child(odd) td { background-color: rgba(255,192,203,0.05); }

/* âœ… à¸ªà¹„à¸•à¸¥à¹Œà¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸–à¸§à¸£à¸§à¸¡ */
tr.total-row td {
Â  font-weight: bold;
Â  background-color: #f8bbd0 !important; /* à¹ƒà¸Šà¹‰à¸ªà¸µà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡ */
}

.empty-row td {
Â  text-align: center;
Â  padding: 15px;
Â  font-style: italic;
Â  color: #c62828;
}
</style>
</head>

<body>
<div class="container">
Â  <div class="logos-top">
Â  Â  <img src="https://i.postimg.cc/507bjy9Z/cdd.png" alt="CDD Logo" />
Â  Â  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZtkPBp_xmIFgEEmX2cyScE1QzabzZbtNdbQ&s" alt="Women Fund Logo" />
Â  </div>

Â  Â  <div id="reportDate"></div>
Â  <div id="reportInfo">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸‡à¸²à¸™...</div>

Â  <div class="filter-bar">
Â  Â  ğŸ” <input type="text" id="filterInput" placeholder="à¸„à¹‰à¸™à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥... à¹€à¸Šà¹ˆà¸™ à¸Šà¸·à¹ˆà¸­à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” à¸«à¸£à¸·à¸­à¸„à¸°à¹à¸™à¸™">
Â  </div>

Â  <div class="table-wrapper">
Â  Â  <table id="dataTable">
Â  Â  Â  <thead id="tableHead"></thead>
Â  Â  Â  <tbody id="tableBody">
Â  Â  Â  Â  <tr class="empty-row"><td colspan="30">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</td></tr>
Â  Â  Â  </tbody>
Â  Â  </table>
Â  </div>
</div>

<script>
// URL à¸‚à¸­à¸‡ Apps Script Deployment à¸‚à¸­à¸‡à¸„à¸¸à¸“
const API_URL = 'https://script.google.com/macros/s/AKfycbyUo2wVFt55Jkj-SpPrIBeCu4ekpB4LvZmvwTwOxMaQyhA4BUuGHTOkvGQBexfVNxlk/exec';
const START_HEADER_ROW = 3;
const END_HEADER_ROW = 5;
const START_BODY_ROW = 6;

function applyMergedCells(cellData, mergedInfo) {
Â  const hiddenCells = Array(cellData.length).fill(0).map(() => Array(cellData[0].length).fill(false));
Â  let html = '';
Â  for (let r = 0; r < cellData.length; r++) {
Â  Â  html += '<tr>';
Â  Â  for (let c = 0; c < cellData[r].length; c++) {
Â  Â  Â  if (hiddenCells[r][c]) continue;
Â  Â  Â  let cellAttributes = '';
Â  Â  Â  let merge = mergedInfo.find(m => m.row === r && m.col === c);
Â  Â  Â  if (merge && (merge.height > 1 || merge.width > 1)) {
Â  Â  Â  Â  cellAttributes += ` rowspan="${merge.height}" colspan="${merge.width}"`;
Â  Â  Â  Â  for (let i = 0; i < merge.height; i++) {
Â  Â  Â  Â  Â  for (let j = 0; j < merge.width; j++) {
Â  Â  Â  Â  Â  Â  if (i === 0 && j === 0) continue;
Â  Â  Â  Â  Â  Â  if (r + i < cellData.length && c + j < cellData[r].length) hiddenCells[r + i][c + j] = true;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  html += `<th ${cellAttributes}>${cellData[r][c] || ''}</th>`;
Â  Â  }
Â  Â  html += '</tr>';
Â  }
Â  return html;
}

async function loadSheet() {
Â  const infoEl = document.getElementById('reportInfo');
Â  const dateEl = document.getElementById('reportDate');
Â  const thead = document.getElementById('tableHead');
Â  const tbody = document.getElementById('tableBody');

Â  try {
Â  Â  const res = await fetch(API_URL);
Â  Â  if (!res.ok) throw new Error('à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰');
Â  Â  const resJson = await res.json();
Â  Â  if (resJson.error) throw new Error(resJson.error);
Â  Â  
Â  Â  const { data, merged } = resJson;
Â  Â  if (!data || !data.length) throw new Error('à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸Šà¸µà¸•');

Â  Â  // 1. à¸ˆà¸±à¸”à¸à¸²à¸£à¸«à¸±à¸§à¸£à¸²à¸¢à¸‡à¸²à¸™à¹à¸¥à¸°à¸§à¸±à¸™à¸—à¸µà¹ˆ
Â  Â  const headerPart = data.slice(0, START_HEADER_ROW);
Â  Â  infoEl.innerHTML = headerPart.slice(0, 2).map(r => r.filter(c => c).join(' ')).join('<br>');
Â  Â  
Â  Â  // âœ… à¸”à¸¶à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸²à¸à¹à¸–à¸§à¸—à¸µà¹ˆ 3 (Index 2)
Â  Â  const dateRow = headerPart[2].filter(c => c).join(' ');
Â  Â  dateEl.textContent = dateRow; // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ "à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¸“ à¸§à¸±à¸™à¸—à¸µà¹ˆ 15 à¸à¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™ 2568"

Â  Â  // 2. à¸ˆà¸±à¸”à¸à¸²à¸£à¸«à¸±à¸§à¸•à¸²à¸£à¸²à¸‡ (Thead)
Â  Â  const headerData = data.slice(START_HEADER_ROW, END_HEADER_ROW + 1);
Â  Â  const headerMerged = merged.filter(m => m.row >= START_HEADER_ROW && m.row <= END_HEADER_ROW)
Â  Â  Â  .map(m => ({ ...m, row: m.row - START_HEADER_ROW }));
Â  Â  thead.innerHTML = applyMergedCells(headerData, headerMerged);

Â  Â  // 3. à¸ˆà¸±à¸”à¸à¸²à¸£à¸ªà¹ˆà¸§à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Tbody)
Â  Â  const bodyData = data.slice(START_BODY_ROW);
Â  Â  renderTableBody(bodyData);

Â  } catch (err) {
Â  Â  infoEl.textContent = 'âŒ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸‡à¸²à¸™';
Â  Â  dateEl.textContent = '';
Â  Â  tbody.innerHTML = `<tr class="empty-row"><td colspan="30">âŒ à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${err.message}</td></tr>`;
Â  }
}

/**
 * à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸£à¹‰à¸²à¸‡ HTML à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™ Body à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¹à¸–à¸§ 'à¸£à¸§à¸¡'
 * @param {Array<Array<any>>} data - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™ Body
 */
function renderTableBody(data) {
Â  const tbody = document.getElementById('tableBody');
Â  tbody.innerHTML = '';
Â  data.forEach((row) => {
Â  Â  let tr = '<tr>';
Â  Â  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¹à¸–à¸§à¸£à¸§à¸¡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ (à¸„à¹ˆà¸²à¹ƒà¸™à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ A (Index 0) à¸«à¸£à¸·à¸­ B (Index 1) à¸¡à¸µà¸„à¸³à¸§à¹ˆà¸² 'à¸£à¸§à¸¡')
Â  Â  const isTotalRow = (String(row[0]).toLowerCase().includes('à¸£à¸§à¸¡') || String(row[1]).toLowerCase().includes('à¸£à¸§à¸¡'));
Â  Â  
Â  Â  if (isTotalRow) {
Â  Â  Â  tr = '<tr class="total-row">';
Â  Â  }

Â  Â  row.forEach((cell, colIndex) => {
Â  Â  Â  let cellAttributes = '';
Â  Â  Â  
Â  Â  Â  // âœ… à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¹à¸–à¸§ 'à¸£à¸§à¸¡' à¹à¸¥à¸°à¹€à¸›à¹‡à¸™à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹à¸£à¸ (A) à¹ƒà¸«à¹‰à¸—à¸³à¸à¸²à¸£à¸£à¸§à¸¡à¹€à¸‹à¸¥à¸¥à¹Œ (A+B)
Â  Â  Â  if (isTotalRow && colIndex === 0) {
Â  Â  Â  Â  cellAttributes = ' colspan="2"';
Â  Â  Â  Â  // à¹à¸ªà¸”à¸‡à¸œà¸¥à¹€à¸‰à¸à¸²à¸°à¸„à¹ˆà¸²à¸ˆà¸²à¸à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ A (à¸‹à¸¶à¹ˆà¸‡à¸„à¸§à¸£à¹€à¸›à¹‡à¸™ 'à¸£à¸§à¸¡')
Â  Â  Â  } else if (isTotalRow && colIndex === 1) {
Â  Â  Â  Â  return; // à¸‚à¹‰à¸²à¸¡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ B à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¸–à¸¹à¸à¸£à¸§à¸¡à¹„à¸›à¹à¸¥à¹‰à¸§
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // à¸ˆà¸±à¸”à¸£à¸¹à¸›à¹à¸šà¸šà¸•à¸±à¸§à¹€à¸¥à¸‚à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢
Â  Â  Â  const value = (typeof cell === 'number') ? cell.toLocaleString('th-TH') : (cell || '');
Â  Â  Â  tr += `<td${cellAttributes}>${value}</td>`;
Â  Â  });
Â  Â  tr += '</tr>';
Â  Â  tbody.innerHTML += tr;
Â  });
}

document.getElementById('filterInput').addEventListener('keyup', function() {
Â  const keyword = this.value.toLowerCase();
Â  const rows = document.querySelectorAll('#tableBody tr');
Â  rows.forEach(r => {
Â  Â  const text = r.innerText.toLowerCase();
Â  Â  r.style.display = text.includes(keyword) ? '' : 'none';
Â  });
});

window.onload = loadSheet;
</script>
</body>
</html>
